<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="Jo Blog">
    <meta property="og:description" content="Jo Seungwan Blog!~~!">
    <meta property="og:image" content="https://raw.githubusercontent.com/joswlv/joswlv.github.io/master/bg.jpg">
    <meta property="og:url" content="https://joswlv.github.io">

    <title>Joswlv</title>
    <meta name="description" content="">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href="/css/fontawesome/css/font-awesome.min.css ">
    <link rel="stylesheet" href="/css/main.css ">
    <link rel="canonical" href="http://joswlv.github.io/page2/">
    <link rel="alternate" type="application/rss+xml" title="Joswlv" href="http://joswlv.github.io/feed.xml ">



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83868242-1', 'auto');
  ga('send', 'pageview');

</script>

</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">Joswlv</a>
        <small></small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/">
                    
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>

                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" index>
    <div class="left">
        <!-- <h1>Welcome to SW's Blog!</h1>
        <small></small> -->
        <hr>
        <ul>
            
              <li>
                <h2>
                  <a class="post-link" href="/2017/05/09/javarxe/">java 유용한 정규표현식</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-05-09
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Java" title="Category: Java" rel="category">Java</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                </div>
                <div class="excerpt">
                    <h1 id="section">1. 특수문자 제거하기</h1>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">StringReplace</span><span class="o">(</span><span class="n">String</span> <span class="n">str</span><span class="o">){</span>       
  <span class="n">String</span> <span class="n">match</span> <span class="o">=</span> <span class="s">"[^\uAC00-\uD7A3xfe0-9a-zA-Z\\s]"</span><span class="o">;</span>
  <span class="n">str</span> <span class="o">=</span><span class="n">str</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="n">match</span><span class="o">,</span> <span class="s">" "</span><span class="o">);</span>
  <span class="k">return</span> <span class="n">str</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>

<h1 id="section-1">2. 이메일 유효성 체크</h1>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isEmailPattern</span><span class="o">(</span><span class="n">String</span> <span class="n">email</span><span class="o">){</span>
	<span class="n">Pattern</span> <span class="n">pattern</span><span class="o">=</span><span class="n">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="s">"\\w+[@]\\w+\\.\\w+"</span><span class="o">);</span>
	<span class="n">Matcher</span> <span class="n">match</span><span class="o">=</span><span class="n">pattern</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">email</span><span class="o">);</span>
	<span class="k">return</span> <span class="n">match</span><span class="o">.</span><span class="na">find</span><span class="o">();</span>
<span class="o">}</span>
</code></pre>
</div>

<h1 id="section-2">3. 연속 스페이스 제거</h1>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">continueSpaceRemove</span><span class="o">(</span><span class="n">String</span> <span class="n">str</span><span class="o">){</span>
	<span class="n">String</span> <span class="n">match2</span> <span class="o">=</span> <span class="s">"\\s{2,}"</span><span class="o">;</span>
	<span class="n">str</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="n">match2</span><span class="o">,</span> <span class="s">" "</span><span class="o">);</span>
	<span class="k">return</span> <span class="n">str</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>

                </div>
                <div class="read-all">
                    <a  href="/2017/05/09/javarxe/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2017/05/04/logback/">LogBack</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-05-04
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Java" title="Category: Java" rel="category">Java</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                </div>
                <div class="excerpt">
                    <h1 id="how-to-use-logback">How to use logback</h1>

<h2 id="logback">logback이란</h2>

<p>logback은 SLF4J의 native 구현체 입니다. slf4j로 어플리케이션 로그를 남긴다면 logback을 선택하는게 가장 좋습니다. slf4j의 도움으로 연관 라이브러리들이 다른 logging framework를 쓰더라도 logback으로 통합할 수 있습니다.</p>

<p>logback 은 logback-core, logback-classic, logback-access의 3개의 모듈이 있습니다. core는 classic과 access의 공통라이브러리입니다. maven repository를 쓴다면 classic만 추가하면 관련 라이브러리가 추가 됩니다.</p>

<p>Maven pom.xml</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code>    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>ch.qos.logback<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>logback-classic<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.1.2<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
</code></pre>
</div>

<pre><code class="language-libraries">External Libraries
Maven: ch.qos.logback:logback-classic:1.1.2
Maven: ch.qos.logback:logback-core:1.1.2
Maven: org.slf4j:slf4j-api:1.7.6
</code></pre>

<h2 id="section">전격 실행</h2>

<p>logback을 사용할수 있는 준비가 끝났습니다. 아래 코드를 바로 실행해봅시다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">ch.qos.logback.classic.LoggerContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">ch.qos.logback.core.util.StatusPrinter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Tutorial</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">Tutorial</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">"trace"</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"debug"</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"info"</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">"warn"</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"error"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h2 id="logger-loggerfactory">Logger, LoggerFactory</h2>
<p>Logger와 LoggerFactory는 SLF4J에 있는 interface와 implements입니다. 실제 어플리케이션상에 logger를 정의 할때 logback 관련 코드를 넣지는 않습니다. 다시 말해 logback과 dependency가 없는 코드를 구현하게 되면 차후 다른 logging framework로 교체하는게 가능하게 됩니다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>		<span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">Tutorial</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</code></pre>
</div>

<div class="language-console highlighter-rouge"><pre class="highlight"><code>20:57:59.346 [main] DEBUG example.logback.Tutorial - debug
20:57:59.350 [main] INFO  example.logback.Tutorial - info
20:57:59.350 [main] WARN  example.logback.Tutorial - warn
20:57:59.350 [main] ERROR example.logback.Tutorial - error
</code></pre>
</div>


                </div>
                <div class="read-all">
                    <a  href="/2017/05/04/logback/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2017/04/20/resourcecleanup/">Resource CleanUp</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-04-20
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Java" title="Category: Java" rel="category">Java</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                </div>
                <div class="excerpt">
                    <h1 id="section">리소스 클린업</h1>

<p>java에서는 GC가 있어 리소스를 관리해준다. 하지만 외부 리소르를 클린업을 하지 않아 오작동을 발생하는 실수를 많이 하게 된다.</p>

<p>단계별로 외부리소를 클린업을 하는 법을 정리하고, 최종적으로 람다표현식을 사용한 리소스클린업을 정리한다.</p>

<h2 id="section-1">흔히하는 실수</h2>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileWriterEx</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">FileWriter</span> <span class="n">writer</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="nf">FileWriterEx</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">fileName</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileWriter</span><span class="o">(</span><span class="n">fileName</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">writeStuff</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">writer</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">finalize</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">writer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">FileWriterEx</span> <span class="n">writerEx</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileWriterEx</span><span class="o">(</span><span class="s">"joswlvTest.txt"</span><span class="o">);</span>
        <span class="n">writerEx</span><span class="o">.</span><span class="na">writeStuff</span><span class="o">(</span><span class="s">"TEST-TEST"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>
<p>이런 경우 <code class="highlighter-rouge">joswlvTest.txt</code>파일은 생성되지만 내용은 비어 잇다. <code class="highlighter-rouge">finalize()</code>가 실행되지 않았고, JVM은 충분한 메모리가 있기 때문에 <code class="highlighter-rouge">finalize()</code>를 할 필요가 없다고 생각한다. 그래서 파일은 종료되지 않고 작성한 내용은 메모리에서 파일로 flush가 되지 않았다.</p>

<h2 id="section-2">수정 1</h2>

<p><code class="highlighter-rouge">흔히하는 실수</code> 문제를 수정하기 위해 명시적으로 <code class="highlighter-rouge">close()</code> 호출을 추가하고 <code class="highlighter-rouge">finalize()</code>메소드를 제거한다.</p>

<p>인스턴스 사용이 끝나면, 해당 인스턴스를 클린업할 것을 명시적으로 요청할 수 있게 한것이다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileWriterEx</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">FileWriter</span> <span class="n">writer</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">FileWriterEx</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">fileName</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileWriter</span><span class="o">(</span><span class="n">fileName</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">writeStuff</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">writer</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">writer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">FileWriterEx</span> <span class="n">writerEx</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileWriterEx</span><span class="o">(</span><span class="s">"joswlvTest.txt"</span><span class="o">);</span>
        <span class="n">writerEx</span><span class="o">.</span><span class="na">writeStuff</span><span class="o">(</span><span class="s">"TEST-TEST"</span><span class="o">);</span>
        <span class="n">writerEx</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">close()</code>를 명시적으로 호출하는 것은 인스턴스가 사용한 외부 리소스를 클린업한다. 그러나 코드에서 예외처리가 일어나면 <code class="highlighter-rouge">close()</code> 메소드가 호출하지 못할 수도 있다.</p>

<h2 id="section-3">수정 2</h2>

<p><code class="highlighter-rouge">close()</code>메소드 호출을 보자하는 수정을 해보자</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileWriterEx</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">FileWriter</span> <span class="n">writer</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">FileWriterEx</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">fileName</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileWriter</span><span class="o">(</span><span class="n">fileName</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">writeStuff</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">writer</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">writer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">FileWriterEx</span> <span class="n">writerEx</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileWriterEx</span><span class="o">(</span><span class="s">"joswlvTest.txt"</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">writerEx</span><span class="o">.</span><span class="na">writeStuff</span><span class="o">(</span><span class="s">"TEST-TEST"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">writerEx</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>이렇게 하면 코드에서 예외가 발생하더라도 리소스에 대한 클린업이 보장된다.</p>

<h2 id="section-4">수정 3</h2>

<p>java SE7에서 부터 제공하는 <code class="highlighter-rouge">ARM (Automatic Resource Management)</code> 기능을 사용해 장황한 코드를 감소 시켜 보자!</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileWriterEx</span> <span class="kd">implements</span> <span class="n">AutoCloseable</span><span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">FileWriter</span> <span class="n">writer</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">FileWriterEx</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">fileName</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileWriter</span><span class="o">(</span><span class="n">fileName</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">writeStuff</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">writer</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
	    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Close호출됨!"</span><span class="o">);</span>
        <span class="n">writer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">(</span><span class="n">FileWriterEx</span> <span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileWriterEx</span><span class="o">(</span><span class="s">"joswlv.txt"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">writer</span><span class="o">.</span><span class="na">writeStuff</span><span class="o">(</span><span class="s">"TEST-TEST"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>클래스의 인스턴스를 <code class="highlighter-rouge">try-with-resources</code> 형태로 생성하고 그블록 안에서 writeStuff()를 호출한다. try 블록을 빠져나오면, 자동적으로 try 블록에 의해 관리되는 인스턴스/리소스에서 <code class="highlighter-rouge">close()</code> 메소드가 호출된다.</p>

<p>이러한 작업을 위해 컴파일러는 <code class="highlighter-rouge">AutoCloseable</code> 인터페이스의 구현에 대한 관리 리소스 클래스가 필요하고, 이 인터페이스는 <code class="highlighter-rouge">close()</code>라는 메소드 하나만 가진다.</p>

<p>ARM을 사용한 코드는 간결하지만 프로그래머가 원하는 시간에 클린업을 할려면 추가적인 작업이 필요하다.</p>

<h2 id="section-5">수정 4</h2>

<p>클래스가 일정 시간 내에 클린업이 되야하는 heavy한 리소스를 사용한다면 다음과 같이 하면 된다.</p>

<p>우선, 생성자와 <code class="highlighter-rouge">close()</code>를 <code class="highlighter-rouge">private</code>로 선언해 프로그래머가 직접 FileWriteEAM의 인스턴스를 생성할 수 없게 한다. 그래서 factory 메소드가 필요하다. 인스턴스를 생성하고 파라미터로 해당 인스턴스를 전달하는 일번적인 factory 메소드와 달리, 작성할 코드는 인스턴스를 사용자에게 전달하고 작업이 끝날 때까지 기다린다.(람다표현식을 이용하면 가능함)</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code>
<span class="cm">/*
FileWriterEAM.java
*/</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileWriterEAM</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">FileWriter</span> <span class="n">writer</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nf">FileWriterEAM</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">fileName</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileWriter</span><span class="o">(</span><span class="n">fileName</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">writeStuff</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">writer</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Close 호출됨"</span><span class="o">);</span>
        <span class="n">writer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">use</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">fileName</span><span class="o">,</span> 
    	<span class="kd">final</span> <span class="n">UseInstance</span><span class="o">&lt;</span><span class="n">FileWriterEAM</span><span class="o">,</span> <span class="n">IOException</span><span class="o">&gt;</span> <span class="n">block</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> 
    <span class="o">{</span>
        <span class="kd">final</span> <span class="n">FileWriterEAM</span> <span class="n">writerEAM</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileWriterEAM</span><span class="o">(</span><span class="n">fileName</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">block</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">writerEAM</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">writerEAM</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
        
        <span class="cm">/* ARM으로 작성해도 된다. (AutoCloseable implements를 받아야한다.)
        try (FileWriterEAM writerEAM = new FileWriterEAM(fileName)) {
            block.accept(writerEAM);
        }
        */</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">FileWriterEAM</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="s">"eam.txt"</span><span class="o">,</span> <span class="n">writerEAM</span> <span class="o">-&gt;</span> <span class="n">writerEAM</span><span class="o">.</span><span class="na">writeStuff</span><span class="o">(</span><span class="s">"GOOD!!"</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="cm">/*
UseInstance.java
*/</span>
<span class="nd">@FunctionalInterface</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UseInstance</span><span class="o">&lt;</span><span class="n">T</span><span class="o">,</span> <span class="n">X</span> <span class="kd">extends</span> <span class="n">Throwable</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">T</span> <span class="n">instance</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">X</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">use()</code> 메소드에서 두개의 파라미터 fileName, UseInstacne 인터페이스에 대한 레퍼런스를 인수로 받는다. 이 메소드에서 FileWriteEAM을 객체화하고 try와 finally 블록을 생성한다. 그리고 나서 인터페이스가 생성되자마자 <code class="highlighter-rouge">accept()</code> 메소드에 FileWriteEAM의 인스턴스를 파라미터로 넘긴다. 호출이 리턴되면, finally 블록에 잇는 인스턴스의 <code class="highlighter-rouge">close()</code>메소드를 호출한다.</p>

<p><code class="highlighter-rouge">@FunctionalInterface</code> Annotation를 붙여 UseInstance는 함수형 인터페이스로 만들어 자바 컴파일러가 자동으로 람다 표현식이나 메소드 레퍼런스를 합성할 수 있도록 한다.</p>

<p>클레스의 사용자들은 인스턴스를 직접 생성하지 못한다. 이런 특징은 인스턴스가 만료되는 시점 이후로 리소스의 클린업일어나는 코드 생성을 막는 효과를 가져온다.</p>

<h3 id="reference">Reference</h3>

<ul>
  <li>자바 8 람다의힘</li>
</ul>

                </div>
                <div class="read-all">
                    <a  href="/2017/04/20/resourcecleanup/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2017/04/08/garbagecollectionpauses/">Garbage collection pauses</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-04-08
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Cassandra" title="Category: Cassandra" rel="category">Cassandra</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                </div>
                <div class="excerpt">
                    <h1 id="section">장애현상</h1>

<p><strong>Using cassandra version : 2.1.8</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>WARN  [GossipTasks:1] 2017-03-21 17:11:05,462 FailureDetector.java:249 - Not marking nodes down due to local pause of 9594745097 &gt; 5000000000
INFO  [GossipTasks:1] 2017-03-21 17:11:05,462 Gossiper.java:968 - InetAddress /10.161.26.248 is now DOWN
INFO  [Service Thread] 2017-03-21 17:11:05,463 GCInspector.java:252 - ConcurrentMarkSweep GC in 9487ms.  CMS Old Gen: 3039553840 -&gt; 3027311712; Par Eden Space: 833093632 -&gt; 0; Par Survivor Space: 46277016 -&gt; 0
</code></pre>
</div>

<p>이런 로그를 찍고 서버가 <code class="highlighter-rouge">down</code> 되었다 살았다를 반복하였다.</p>

<h1 id="section-1">원인</h1>

<ul>
  <li><a href="https://docs.datastax.com/en/landing_page/doc/landing_page/troubleshooting/cassandra/gcPauses.html">https://docs.datastax.com/en/landing_page/doc/landing_page/troubleshooting/cassandra/gcPauses.html</a></li>
</ul>

<p><code class="highlighter-rouge">Garbage collection pause</code>라고 한다. 이 현상이 있으면 해당 노드가 다른 노드에 down 된 것처럼 보일 수 있다고 한다.</p>

<p>원인은 아래 4가지 정도가 있다고 한다.</p>

<ul>
  <li>If the problem is recent, check for any recent applications changes.</li>
  <li>Excessive tombstone activity: often caused by heavy delete workloads.</li>
  <li>Large row updates or large batch updates: reduce the size of the individual write below 1 Mb (at the most).</li>
  <li>Extremely wide rows: manifests as problems in repairs, selects, caching, and elsewhere.</li>
</ul>

<p>지금 운영 중인 카산드라 특성상 비슷한 TTL이 걸려 있는 데이터들이 많은데, 한달전에 인입된 데이터가 <code class="highlighter-rouge">heavy delete</code>되면서 발생한 문제인것으로 추측한다.</p>

<p><code class="highlighter-rouge">Not marking nodes down due to local pause</code> 로그는 pause 현상이 너무 오래 지속되었을 때 node down이 계속 된 것처럼 보이기 때문에 client에서 심각한 에러가 발생했다고 볼 수 있어서 최대 시간(5초) 보다 크면 node down 표시를 skip 하겠다 라고 알려주는 로그라고한다.</p>

<p><code class="highlighter-rouge">Garbage collection pause</code>현상은 <code class="highlighter-rouge">2.1.6</code>버전 부터 패치되어 최대시간(5초)동안 서버가 down되었다 살았다를 반복한다.</p>

<p><a href="https://issues.apache.org/jira/browse/CASSANDRA-9183">https://issues.apache.org/jira/browse/CASSANDRA-9183</a></p>

<h1 id="section-2">해결방안</h1>

<p>해결 방안은 크게 두가지 방법이 존재한다.</p>

<ol>
  <li>Java 1.7부터 도입된 G1 방식으로 튜닝</li>
  <li>Cassandra 메모리 설정을 바꾸는 방법</li>
</ol>

<p>1번은 현재 사용하고 있는 CMS GC방식이 아닌 Java 1.7부터 도입된 G1 방식으로 튜닝한다.</p>

<p><strong><a href="https://medium.com/@mlowicki/move-cassandra-2-1-to-g1-garbage-collector-b9fb27365509">https://medium.com/@mlowicki/move-cassandra-2-1-to-g1-garbage-collector-b9fb27365509</a></strong></p>

<p>datastax 에서는 2번 방법 위주로 튜닝 가이드를 제공하고 있다.
<code class="highlighter-rouge">MAX_HEAP_SIZE</code>, <code class="highlighter-rouge">HEAP_NEWSIZE</code>를 조정하는 방법이다.</p>

<p><strong><a href="https://docs.datastax.com/en/cassandra/2.1/cassandra/operations/ops_tune_jvm_c.html">https://docs.datastax.com/en/cassandra/2.1/cassandra/operations/ops_tune_jvm_c.html</a></strong></p>

<p><code class="highlighter-rouge">cassandra-env.sh</code> 설정을 보면 이런 계산식에 의해 default 세팅이 되어 있다.</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">MAX_HEAP_SIZE</code> = max(min(1/2 ram, 1024MB), min(1/4 ram, 8GB))</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">HEAP_NEWSIZE</code> = min(max_sensible_per_modern_cpu_core * num_cores, 1/4 * heap size)  <br />
(max_sensible_per_modern_cpu_core 는 100으로 세팅됨)</p>
  </li>
</ul>

<p>카산드라 서버들이 모두 24 CPU core, 16G 메모리를 가지고 있으므로
<code class="highlighter-rouge">MAX_HEAP_SIZE</code>는 4G, <code class="highlighter-rouge">HEAP_NEWSIZE</code>는 1G 로 세팅되어 있다.</p>

<p>datastax 가이드 추천대로라면
<code class="highlighter-rouge">MAX_HEAP_SIZE</code>= 8G,  <code class="highlighter-rouge">HEAP_NEWSIZE</code>=2G 정도까지 늘릴 수 있을 것 같다.
그리고 현재 서버 메모리를 40%정도만 사용하고 있으므로 큰 영향은 없을 것 같다.</p>


                </div>
                <div class="read-all">
                    <a  href="/2017/04/08/garbagecollectionpauses/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2017/04/02/runtojarbackground/">jar 백그라운드로 실행하기</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-04-02
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Etc" title="Category: Etc" rel="category">Etc</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                </div>
                <div class="excerpt">
                    <h1 id="jar--">Jar 백그라운드로 실행하기</h1>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="nv">JARFile</span><span class="o">=</span><span class="s2">"KafkaOffsetMonitor-assembly-0.2.1.jar"</span>
<span class="nv">DIR</span><span class="o">=</span><span class="s2">"/home1/irteam/seungwan"</span>
<span class="k">function </span>start <span class="o">{</span>
    <span class="k">if </span>pkill -0 -f <span class="nv">$JARFile</span> &gt; /dev/null 2&gt;&amp;1
    <span class="k">then </span><span class="nb">echo</span> <span class="s2">"Service [</span><span class="nv">$JARFile</span><span class="s2">] is already running. Ignoring startup request/"</span>
      <span class="nb">exit </span>1
    <span class="k">fi
    </span><span class="nb">echo</span> <span class="s2">"Staring [</span><span class="nv">$JARFile</span><span class="s2">] Application!!"</span>
    nohup java -cp KafkaOffsetMonitor-assembly-0.2.1.jar com.quantifind.kafka.offsetapp.OffsetGetterWeb --zk tcambkaf-91b901.svr.toastmaker.net,tcambkaf-91b902.svr.toastmaker.net --port 8080 --refresh 10.seconds --retain 2.days&gt; <span class="nv">$DIR</span>/log.txt 2&gt;&amp;1 &amp;

<span class="o">}</span>

<span class="k">function </span>stop <span class="o">{</span>
    <span class="k">if</span> ! pkill -0 -f <span class="nv">$JARFile</span> &gt; /dev/null 2&gt;&amp;1
    <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"Service [</span><span class="nv">$JARFile</span><span class="s2">] is not running. Ignoring shutdown request."</span>
        <span class="k">return </span>0
    <span class="k">fi

    </span><span class="nb">echo</span> <span class="s2">"Stopping [</span><span class="nv">$JARFile</span><span class="s2">]!!"</span>

    <span class="c"># First, we will try to trigger a controlled shutdown using</span>

    <span class="c"># Wait until the server process has shut down</span>
    <span class="nv">attempts</span><span class="o">=</span>0
    <span class="k">while </span>pkill -0 -f <span class="nv">$JARFile</span> &gt; /dev/null 2&gt;&amp;1
    <span class="k">do
        </span><span class="nv">attempts</span><span class="o">=</span><span class="nv">$[$attempts</span> + 1]
        <span class="k">if</span> <span class="o">[</span> <span class="nv">$attempts</span> -gt 5 <span class="o">]</span>
        <span class="k">then</span>
            <span class="c"># We have waited too long. Kill it.</span>
            pkill -f <span class="nv">$JARFile</span> &gt; /dev/null 2&gt;&amp;1
        <span class="k">fi
        </span>sleep 1s
    <span class="k">done
    </span><span class="nb">echo</span> <span class="s2">"Stop [</span><span class="nv">$JARFile</span><span class="s2">] is completed!!"</span>
<span class="o">}</span>

<span class="k">function </span>status <span class="o">{</span>
    <span class="k">if </span>pkill -0 -f <span class="nv">$JARFile</span> &gt; /dev/null 2&gt;&amp;1
    <span class="k">then </span><span class="nb">echo</span> <span class="s2">"Service [</span><span class="nv">$JARFile</span><span class="s2">] is running."</span>
      <span class="nb">exit </span>1
    <span class="k">fi
    </span><span class="nb">echo</span> <span class="s2">"Service [</span><span class="nv">$JARFile</span><span class="s2">] is not running"</span>
<span class="o">}</span>

<span class="k">case</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="k">in
  </span>status<span class="p">)</span>
    status
    <span class="p">;;</span>
  stop<span class="p">)</span>
        stop
    <span class="p">;;</span>
  start<span class="p">)</span>
        start
    <span class="p">;;</span>
  restart<span class="p">)</span>
    stop
    start
    <span class="p">;;</span>
  <span class="k">*</span><span class="p">)</span>
    <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> {start|stop|restart|status}"</span>
    <span class="nb">exit </span>1
<span class="k">esac

</span><span class="nb">exit </span>0
</code></pre>
</div>

<ul>
  <li><code class="highlighter-rouge">/dev/null</code>은 어디에도 콘솔로그를 출력하지 않겠다는 뜻</li>
  <li><code class="highlighter-rouge">2&gt;&amp;1</code>은 표준에러는 표준출력에 출력하겠다는 뜻</li>
  <li><code class="highlighter-rouge">$DIR/log.txt 2&gt;&amp;1</code>은 표준에러를 파일에 적지 않고 콘솔에 출력하겠다는 뜻 이렇게 2&gt;&amp;1 리다이렉션을 시켜 줌으로 인해 stderr &gt; stdout 으로 출력이 되고 log.txt파일에 기록됨</li>
  <li><code class="highlighter-rouge">nohup</code>명령어는 프로세스 중단(hangup)을 무시하고 명령어를 실행한다는 뜻</li>
  <li><code class="highlighter-rouge">nohup</code>명령어 끝에 <code class="highlighter-rouge">&amp;</code>를 추가 하면 백그라운드로 실행</li>
  <li><code class="highlighter-rouge">&gt; /dev/null 2&gt;&amp;1</code>도 있는데, 이는 표준 출력을 무시하고, 표준에러만 화면에 출력하겠다는 뜻</li>
  <li><code class="highlighter-rouge">&gt;</code>연산자는 redirection을 의미함</li>
</ul>

<h3 id="reference">Reference</h3>

<ul>
  <li><a href="http://reebok.tistory.com/56">http://reebok.tistory.com/56</a></li>
  <li><a href="https://www.xaprb.com/blog/2006/06/06/what-does-devnull-21-mean/">https://www.xaprb.com/blog/2006/06/06/what-does-devnull-21-mean/</a></li>
</ul>

                </div>
                <div class="read-all">
                    <a  href="/2017/04/02/runtojarbackground/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2017/03/27/mavenbuildplugin/">Maven Build Plugin & 옵션</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-03-27
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Etc" title="Category: Etc" rel="category">Etc</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                </div>
                <div class="excerpt">
                    <h1 id="maven-build-plugin">Maven Build Plugin</h1>

<h2 id="resource---">1. 디렉토리에 Resource 디렉토리 추가 방법</h2>

<p>Maven 빌드를 할때, <code class="highlighter-rouge">src</code> 이외에 디록토리를 추가가 필요 할때가 있다.</p>

<p>방법은 다음과 같다.</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;build&gt;</span>
<span class="nt">&lt;resources&gt;</span>
	<span class="nt">&lt;resource&gt;</span>
		<span class="nt">&lt;directory&gt;</span>bin<span class="nt">&lt;/directory&gt;</span>
		<span class="nt">&lt;targetPath&gt;</span>${basedir}/target/bin<span class="nt">&lt;/targetPath&gt;</span>
	<span class="nt">&lt;/resource&gt;</span>
	<span class="nt">&lt;resource&gt;</span>
		<span class="nt">&lt;directory&gt;</span>conf<span class="nt">&lt;/directory&gt;</span>
		<span class="nt">&lt;targetPath&gt;</span>${basedir}/target/conf<span class="nt">&lt;/targetPath&gt;</span>
	<span class="nt">&lt;/resource&gt;</span>
<span class="nt">&lt;/resources&gt;</span>

...

<span class="nt">&lt;/build&gt;</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">bin</code>, <code class="highlighter-rouge">conf</code> 디렉토리를 빌드 할때 함께 추가한다고 명시하면된다.</p>

<h2 id="jar----">2. 빌드한 jar를 저장 위치를 변경하는 법</h2>

<p><code class="highlighter-rouge">src</code>디렉토리의 java파일을 컴파일해 만들어진 jar파일은 기본 /target아래에 만들어진다.</p>

<p>이 위치를 변경하고 싶으면 다음과 같다.</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;build&gt;</span>
	<span class="nt">&lt;plugins&gt;</span>
		<span class="nt">&lt;plugin&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>maven-jar-plugin<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;configuration&gt;</span>
				<span class="nt">&lt;outputDirectory&gt;</span>${basedir}/target/lib<span class="nt">&lt;/outputDirectory&gt;</span>
			<span class="nt">&lt;/configuration&gt;</span>
		<span class="nt">&lt;/plugin&gt;</span>
	<span class="nt">&lt;/plugins&gt;</span>

...

<span class="nt">&lt;/build&gt;</span>
</code></pre>
</div>

<h2 id="dependency--jar-">3. dependency를 포함한 jar 만들기</h2>

<p>이 방법은 여러가지가 있다. 그 중 assembly plugin을 사용하면 다음과 같다.</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;plugin&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>maven-assembly-plugin<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;descriptorRefs&gt;</span>
            <span class="nt">&lt;descriptorRef&gt;</span>jar-with-dependencies<span class="nt">&lt;/descriptorRef&gt;</span>
        <span class="nt">&lt;/descriptorRefs&gt;</span>
    <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;executions&gt;</span>
        <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;id&gt;</span>make-assembly<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;phase&gt;</span>package<span class="nt">&lt;/phase&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
                <span class="nt">&lt;goal&gt;</span>single<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
        <span class="nt">&lt;/execution&gt;</span>
    <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre>
</div>

<h2 id="dependency-jar----">4. dependency jar를 모아 저장해 빌드하는 법</h2>

<p>dependency에 있는 라이브러리 jar파일을 사용자가 지정한 디렉토리에 저장하는 방법은 다음과 같다.</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;plugin&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>maven-dependency-plugin<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;executions&gt;</span>
		<span class="nt">&lt;execution&gt;</span>
			<span class="nt">&lt;id&gt;</span>copy-dependencies<span class="nt">&lt;/id&gt;</span>
			<span class="nt">&lt;phase&gt;</span>package<span class="nt">&lt;/phase&gt;</span>
			<span class="nt">&lt;goals&gt;</span>
				<span class="nt">&lt;goal&gt;</span>copy-dependencies<span class="nt">&lt;/goal&gt;</span>
			<span class="nt">&lt;/goals&gt;</span>
			<span class="nt">&lt;configuration&gt;</span>
				<span class="nt">&lt;outputDirectory&gt;</span>${basedir}/target/lib<span class="nt">&lt;/outputDirectory&gt;</span>
				<span class="nt">&lt;overWriteReleases&gt;</span>false<span class="nt">&lt;/overWriteReleases&gt;</span>
				<span class="nt">&lt;overWriteSnapshots&gt;</span>false<span class="nt">&lt;/overWriteSnapshots&gt;</span>
				<span class="nt">&lt;overWriteIfNewer&gt;</span>true<span class="nt">&lt;/overWriteIfNewer&gt;</span>
			<span class="nt">&lt;/configuration&gt;</span>
		<span class="nt">&lt;/execution&gt;</span>
	<span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre>
</div>
<h1 id="alpha-beta-real--resources-dir">alpha, beta, real에 따라 resources dir구분하기</h1>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;properties&gt;</span>
	<span class="nt">&lt;maven.resources.overwrite&gt;</span>true<span class="nt">&lt;/maven.resources.overwrite&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
<span class="nt">&lt;profiles&gt;</span>
	<span class="nt">&lt;profile&gt;</span>
		<span class="nt">&lt;id&gt;</span>dev<span class="nt">&lt;/id&gt;</span>
		<span class="nt">&lt;properties&gt;</span>
			<span class="nt">&lt;env&gt;</span>dev<span class="nt">&lt;/env&gt;</span>
		<span class="nt">&lt;/properties&gt;</span>
	<span class="nt">&lt;/profile&gt;</span>

	<span class="nt">&lt;profile&gt;</span>
		<span class="nt">&lt;id&gt;</span>alpha<span class="nt">&lt;/id&gt;</span>
		<span class="nt">&lt;properties&gt;</span>
			<span class="nt">&lt;env&gt;</span>alpha<span class="nt">&lt;/env&gt;</span>
		<span class="nt">&lt;/properties&gt;</span>
	<span class="nt">&lt;/profile&gt;</span>

	<span class="nt">&lt;profile&gt;</span>
		<span class="nt">&lt;id&gt;</span>beta<span class="nt">&lt;/id&gt;</span>
		<span class="nt">&lt;properties&gt;</span>
			<span class="nt">&lt;env&gt;</span>beta<span class="nt">&lt;/env&gt;</span>
		<span class="nt">&lt;/properties&gt;</span>
	<span class="nt">&lt;/profile&gt;</span>

	<span class="nt">&lt;profile&gt;</span>
		<span class="nt">&lt;id&gt;</span>real<span class="nt">&lt;/id&gt;</span>
		<span class="nt">&lt;properties&gt;</span>
			<span class="nt">&lt;env&gt;</span>real<span class="nt">&lt;/env&gt;</span>
			<span class="nt">&lt;value&gt;</span>real<span class="nt">&lt;/value&gt;</span>
		<span class="nt">&lt;/properties&gt;</span>
	<span class="nt">&lt;/profile&gt;</span>
<span class="nt">&lt;/profiles&gt;</span>

<span class="nt">&lt;build&gt;</span>
	<span class="nt">&lt;finalName&gt;</span>DMP-DATA-API<span class="nt">&lt;/finalName&gt;</span>
	<span class="nt">&lt;resources&gt;</span>
		<span class="nt">&lt;resource&gt;</span>
			<span class="nt">&lt;directory&gt;</span>src/main/resources<span class="nt">&lt;/directory&gt;</span>
		<span class="nt">&lt;/resource&gt;</span>
		<span class="nt">&lt;resource&gt;</span>
			<span class="nt">&lt;directory&gt;</span>src/main/resources-${env}<span class="nt">&lt;/directory&gt;</span>
		<span class="nt">&lt;/resource&gt;</span>
	<span class="nt">&lt;/resources&gt;</span>
	...
<span class="nt">&lt;/build&gt;</span>
</code></pre>
</div>

<p>profile에 변수를 등록하고 <code class="highlighter-rouge">&lt;resource&gt;</code>에 <code class="highlighter-rouge">directory</code>path만 적어 주면 된다.</p>

<p>resource diretory가 하나로 합쳐지면서 같은 파일명은 <code class="highlighter-rouge">resources-${env}</code>의 파일 명으로 overwrite 된다. 
그 이유는 순차적을 실행되면서 overwrite 되기 때문이다.
(<code class="highlighter-rouge">&lt;maven.resources.overwrite&gt;true&lt;/maven.resources.overwrite&gt;</code> 이 조건을 추가 해서..)</p>

<p>아래와 같이 resources폴더를 구성하고 <code class="highlighter-rouge">mvn clean package -P real</code>을 하면 순차적으로 copy되는 것을 확인 할 수 있다.</p>

<p><br /></p>

<p><img src="http://joswlv.github.io/images/maven_directory.png" alt="" /></p>

<div class="highlighter-rouge"><pre class="highlight"><code>[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ dmp-data-api ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] Copying 6 resources		//resources
[INFO] Copying 3 resources		//resources-${env}
</code></pre>
</div>


                </div>
                <div class="read-all">
                    <a  href="/2017/03/27/mavenbuildplugin/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
        </ul>



        <!-- Pagination links -->
        <div class="pagination">
          
            <a href="/index.html" class="previous"><i class="fa fa-angle-double-left"></i></a>
            <a href="/" class="previous"><i class="fa fa-angle-left"></i></a>
          
          <span class="page_number ">2/11</span>
          
            <a href="/page3" class="next"><i class="fa fa-angle-right"></i></a>
            <a href="/page11" class="next"><i class="fa fa-angle-double-right"></i></a>
          
        </div>
    </div>
    <!-- <button class="anchor"><i class="fa fa-anchor"></i></button> -->
    <div class="right">
        <div class="wrap">
            <!-- Content -->
            <div class="side ">
                <div>
                    <i class="fa fa-th-list"></i>
                    Categories
                </div>
                <ul class="content-ul" cate>
                    
                    <li>
                        <a href="/category/#js" class="categories-list-item" cate="js">
                            <span class="name">
                                js
                            </span>
                            <span class="badge">8</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#web" class="categories-list-item" cate="web">
                            <span class="name">
                                web
                            </span>
                            <span class="badge">15</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#python" class="categories-list-item" cate="python">
                            <span class="name">
                                python
                            </span>
                            <span class="badge">3</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Spring" class="categories-list-item" cate="Spring">
                            <span class="name">
                                Spring
                            </span>
                            <span class="badge">4</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Hadoop" class="categories-list-item" cate="Hadoop">
                            <span class="name">
                                Hadoop
                            </span>
                            <span class="badge">2</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Java" class="categories-list-item" cate="Java">
                            <span class="name">
                                Java
                            </span>
                            <span class="badge">9</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Etc" class="categories-list-item" cate="Etc">
                            <span class="name">
                                Etc
                            </span>
                            <span class="badge">7</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Unix/Linux" class="categories-list-item" cate="Unix/Linux">
                            <span class="name">
                                Unix/Linux
                            </span>
                            <span class="badge">3</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Swift" class="categories-list-item" cate="Swift">
                            <span class="name">
                                Swift
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#MYSQL" class="categories-list-item" cate="MYSQL">
                            <span class="name">
                                MYSQL
                            </span>
                            <span class="badge">4</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#BigData" class="categories-list-item" cate="BigData">
                            <span class="name">
                                BigData
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#ElasticSearch" class="categories-list-item" cate="ElasticSearch">
                            <span class="name">
                                ElasticSearch
                            </span>
                            <span class="badge">2</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Spark" class="categories-list-item" cate="Spark">
                            <span class="name">
                                Spark
                            </span>
                            <span class="badge">3</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Cassandra" class="categories-list-item" cate="Cassandra">
                            <span class="name">
                                Cassandra
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Scala" class="categories-list-item" cate="Scala">
                            <span class="name">
                                Scala
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                </ul>
            </div>
            <div class="side">
                <div>
                    <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                    Recent Posts
                </div>
                <ul class="content-ul" recent>
                    
                        <li><a href="/2017/10/24/sparkstreamingandkafka/">SparStreaming & kafka(Exactly-once)</a></li>
                    
                        <li><a href="/2017/09/27/spark_misapprehension/">Spark에 대한 오해</a></li>
                    
                        <li><a href="/2017/08/06/howtousesbt/">sbt 기본 사용법</a></li>
                    
                        <li><a href="/2017/08/02/pythonTricks/">Python Tricks</a></li>
                    
                        <li><a href="/2017/08/01/MySql-Setting/">MySQL 기본세팅법</a></li>
                    
                        <li><a href="/2017/06/26/linuxcommand/">리눅스 명령어정리</a></li>
                    
                        <li><a href="/2017/05/09/javarxe/">java 유용한 정규표현식</a></li>
                    
                        <li><a href="/2017/05/04/logback/">LogBack</a></li>
                    
                        <li><a href="/2017/04/20/resourcecleanup/">Resource CleanUp</a></li>
                    
                        <li><a href="/2017/04/08/garbagecollectionpauses/">Garbage collection pauses</a></li>
                    
                </ul>
            </div>

<!--
            <div class="side">
                <div>
                    <i class="fa fa-tags"></i>
                    Tags
                </div>
                <div class="tags-cloud">
                    
                    
                    
                    

                    

                    
                </div>
            </div> -->
        </div>
    </div>
</div>


    <footer class="site-footer">


    <div class="wrapper">

        <p class="description">
            
        </p>
        <p class="contact">
            Contact me at: 
            <a href="https://github.com/joswlv" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a>  
            <a href="mailto:wh7923@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>     
            <a href="https://www.facebook.com/wsj7923" title="Facebook"><i class="fa fa-facebook-official" aria-hidden="true"></i></a>    
        </p>
        <p>
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>
        </p>
    </div>
</footer>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <div class="back-to-top">
    <a href="#top" class="scroll">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/scroll.min.js " charset="utf-8"></script>
  </body>

</html>
