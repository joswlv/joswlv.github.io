<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="Jo Blog">
    <meta property="og:description" content="Jo Seungwan Blog!~~!">
    <meta property="og:image" content="https://raw.githubusercontent.com/joswlv/joswlv.github.io/master/bg.jpg">
    <meta property="og:url" content="https://joswlv.github.io">

    <title>리플렉션API와 프로퍼티를 이용한 객체관리</title>
    <meta name="description" content="1. Reflection API리플렉션이란 객체를 통해 클래스의 정보를 분석해 내는 프로그램 기법을 말한다. 투영, 반사 라는 사전적인 의미를 지니고 있다.자바는 스크립트 언어가 아닌 컴파일 언어이다. 물론 .java -&gt; .class -&gt; 실행이라는 2단계의 메커니즘을...">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href="/css/fontawesome/css/font-awesome.min.css ">
    <link rel="stylesheet" href="/css/main.css ">
    <link rel="canonical" href="http://joswlv.github.io/2016/09/17/reflection_property/">
    <link rel="alternate" type="application/rss+xml" title="Joswlv" href="http://joswlv.github.io/feed.xml ">



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83868242-1', 'auto');
  ga('send', 'pageview');

</script>

</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">Joswlv</a>
        <small></small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/">
                    
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>

                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" post>
    <div class="left">
        <h1>리플렉션API와 프로퍼티를 이용한 객체관리</h1>
        <div class="label">

            <div class="label-card">
                <i class="fa fa-calendar"></i>2016-09-17
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
                
            </div>

            <div class="label-card">
            


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#web" title="Category: web" rel="category">web</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


            </div>

        </div>
        <hr>
        <article itemscope itemtype="http://schema.org/BlogPosting">
        <h1 id="reflection-api">1. Reflection API</h1>

<p>리플렉션이란 객체를 통해 클래스의 정보를 분석해 내는 프로그램 기법을 말한다. 투영, 반사 라는 사전적인 의미를 지니고 있다.</p>

<p>자바는 스크립트 언어가 아닌 컴파일 언어이다. 물론 .java -&gt; .class -&gt; 실행이라는 2단계의 메커니즘을 가지고 있지만 컴파일 언어로 분리하는 게 옳다. 원래 자바에서는 동적으로 객체를 생성하는 기술이 없었다. 그리고 동적으로 인스턴스를 생성하는 Reflection으로 그 역활을 대신하게 된다.</p>

<p>즉 클래스나 메서드의 내부 구조를 들여다 볼 때 사용하는 도구라는 뜻이다.<br /></p>

<table>
  <thead>
    <tr>
      <th>메서드</th>
      <th>설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Class.newInstance()</td>
      <td>주어진 클래스의 인스턴스를 생성</td>
    </tr>
    <tr>
      <td>Class.getName()</td>
      <td>클래스의 이름을 반환</td>
    </tr>
    <tr>
      <td>Class.getMethods()</td>
      <td>클래스에 선언된 모든 public 메서드의 목록을 배열로 반환</td>
    </tr>
    <tr>
      <td>Method.invoke()</td>
      <td>해당 메서드를 호출</td>
    </tr>
    <tr>
      <td>Method.getParameterTypes()</td>
      <td>메서드의 매개변수 목록을 배열로 반환</td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<h4 id="vo---reflection---">VO 객체 생성을 Reflection을 사용하여 만드는 시나리오</h4>

<p><img src="http://joswlv.github.io/images/voobject.png" alt="" /></p>

<ol>
  <li>웹 브라우저는 회원 등록을 요청합니다. 사용자가 입력한 매개변수 값을 서블릿에 전달한다.</li>
  <li>프런트 컨트롤러 <code class="highlighter-rouge">DispatcherServlet</code>은 회원 등록을 처리하는 페이지 컨트롤러에게 어떤 데이터가 필요한지 물어본다. 페이지 컨트롤러 <code class="highlighter-rouge">MemberAddController</code>는 작업하는 데 필요한 데이터의 이름과 타입 정보를 담은 배열을 리턴한다.</li>
  <li>프런트 컨트롤러는 <code class="highlighter-rouge">ServletRequestDataBinder</code>를 이용하여, 요청 매개변수로부터 페이지 컨트롤러가 원하는 형식의 값객체(예: Member, Integer, Date등)를 만든다.</li>
  <li>프런트 컨트롤러는 <code class="highlighter-rouge">ServletRequestDataBinder</code>가 만들어 준 값 객체를 Map에 저장한다.</li>
  <li>프런트 컨트롤러는 페이지 컨트롤러 <code class="highlighter-rouge">MemberAddController</code>를 실행한다. 페이지 컨트롤러의 execute()를 호출할 때, 값이 저장된 Map 객체를 매개변수로 넘긴다.</li>
</ol>

<p>아래 소스는 프런트 컨트롤러에서 VO 객체 생성을 Reflection을 사용하여 자동화 한것이다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">// DataBinding 처리</span>
<span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"serial"</span><span class="o">)</span>
<span class="nd">@WebServlet</span><span class="o">(</span><span class="s">"*.do"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DispatcherServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span>
      <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span>
      <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"text/html; charset=UTF-8"</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">servletPath</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getServletPath</span><span class="o">();</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">ServletContext</span> <span class="n">sc</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">();</span>
      
      <span class="c1">// 페이지 컨트롤러에게 전달할 Map 객체를 준비한다. </span>
      <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;();</span>
      <span class="n">model</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"session"</span><span class="o">,</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">());</span>
      
      <span class="n">Controller</span> <span class="n">pageController</span> <span class="o">=</span> <span class="o">(</span><span class="n">Controller</span><span class="o">)</span> <span class="n">sc</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">servletPath</span><span class="o">);</span>
      
      <span class="k">if</span> <span class="o">(</span><span class="n">pageController</span> <span class="k">instanceof</span> <span class="n">DataBinding</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">prepareRequestData</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">model</span><span class="o">,</span> <span class="o">(</span><span class="n">DataBinding</span><span class="o">)</span><span class="n">pageController</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="c1">// 페이지 컨트롤러를 실행한다.</span>
      <span class="n">String</span> <span class="n">viewUrl</span> <span class="o">=</span> <span class="n">pageController</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">model</span><span class="o">);</span>
      
      <span class="c1">// Map 객체에 저장된 값을 ServletRequest에 복사한다.</span>
      <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">key</span> <span class="o">:</span> <span class="n">model</span><span class="o">.</span><span class="na">keySet</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">model</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">));</span>
      <span class="o">}</span>
      
      <span class="k">if</span> <span class="o">(</span><span class="n">viewUrl</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"redirect:"</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="n">viewUrl</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">9</span><span class="o">));</span>
        <span class="k">return</span><span class="o">;</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">RequestDispatcher</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="n">viewUrl</span><span class="o">);</span>
        <span class="n">rd</span><span class="o">.</span><span class="na">include</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
      <span class="o">}</span>
      
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
      <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"error"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
      <span class="n">RequestDispatcher</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="s">"/Error.jsp"</span><span class="o">);</span>
      <span class="n">rd</span><span class="o">.</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">prepareRequestData</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
      <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">model</span><span class="o">,</span> <span class="n">DataBinding</span> <span class="n">dataBinding</span><span class="o">)</span>
      <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">Object</span><span class="o">[]</span> <span class="n">dataBinders</span> <span class="o">=</span> <span class="n">dataBinding</span><span class="o">.</span><span class="na">getDataBinders</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">dataName</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">dataType</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="n">Object</span> <span class="n">dataObj</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dataBinders</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">+=</span><span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">dataName</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">dataBinders</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
      <span class="n">dataType</span> <span class="o">=</span> <span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;)</span> <span class="n">dataBinders</span><span class="o">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">];</span>
      <span class="n">dataObj</span> <span class="o">=</span> <span class="n">ServletRequestDataBinder</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">dataType</span><span class="o">,</span> <span class="n">dataName</span><span class="o">);</span>
      <span class="n">model</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">dataName</span><span class="o">,</span> <span class="n">dataObj</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p><br /></p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServletRequestDataBinder</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Object</span> <span class="nf">bind</span><span class="o">(</span>
      <span class="n">ServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">dataType</span><span class="o">,</span> <span class="n">String</span> <span class="n">dataName</span><span class="o">)</span> 
      <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">isPrimitiveType</span><span class="o">(</span><span class="n">dataType</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">return</span> <span class="nf">createValueObject</span><span class="o">(</span><span class="n">dataType</span><span class="o">,</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="n">dataName</span><span class="o">));</span>
    <span class="o">}</span>
    
    <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">paramNames</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameterMap</span><span class="o">().</span><span class="na">keySet</span><span class="o">();</span>
    <span class="n">Object</span> <span class="n">dataObject</span> <span class="o">=</span> <span class="n">dataType</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
    <span class="n">Method</span> <span class="n">m</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    
    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">paramName</span> <span class="o">:</span> <span class="n">paramNames</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">m</span> <span class="o">=</span> <span class="n">findSetter</span><span class="o">(</span><span class="n">dataType</span><span class="o">,</span> <span class="n">paramName</span><span class="o">);</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">m</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">m</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">dataObject</span><span class="o">,</span> <span class="n">createValueObject</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">getParameterTypes</span><span class="o">()[</span><span class="mi">0</span><span class="o">],</span> 
            <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="n">paramName</span><span class="o">)));</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">dataObject</span><span class="o">;</span>
  <span class="o">}</span>
  
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isPrimitiveType</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"int"</span><span class="o">)</span> <span class="o">||</span> <span class="n">type</span> <span class="o">==</span> <span class="n">Integer</span><span class="o">.</span><span class="na">class</span> <span class="o">||</span>
        <span class="n">type</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"long"</span><span class="o">)</span> <span class="o">||</span> <span class="n">type</span> <span class="o">==</span> <span class="n">Long</span><span class="o">.</span><span class="na">class</span> <span class="o">||</span>
        <span class="n">type</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"float"</span><span class="o">)</span> <span class="o">||</span> <span class="n">type</span> <span class="o">==</span> <span class="n">Float</span><span class="o">.</span><span class="na">class</span> <span class="o">||</span>
        <span class="n">type</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"double"</span><span class="o">)</span> <span class="o">||</span> <span class="n">type</span> <span class="o">==</span> <span class="n">Double</span><span class="o">.</span><span class="na">class</span> <span class="o">||</span>
        <span class="n">type</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"boolean"</span><span class="o">)</span> <span class="o">||</span> <span class="n">type</span> <span class="o">==</span> <span class="n">Boolean</span><span class="o">.</span><span class="na">class</span> <span class="o">||</span>
        <span class="n">type</span> <span class="o">==</span> <span class="n">Date</span><span class="o">.</span><span class="na">class</span> <span class="o">||</span> <span class="n">type</span> <span class="o">==</span> <span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
  <span class="o">}</span>
  
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">Object</span> <span class="nf">createValueObject</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">type</span><span class="o">,</span> <span class="n">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"int"</span><span class="o">)</span> <span class="o">||</span> <span class="n">type</span> <span class="o">==</span> <span class="n">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nf">Integer</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"float"</span><span class="o">)</span> <span class="o">||</span> <span class="n">type</span> <span class="o">==</span> <span class="n">Float</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nf">Float</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"double"</span><span class="o">)</span> <span class="o">||</span> <span class="n">type</span> <span class="o">==</span> <span class="n">Double</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nf">Double</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"long"</span><span class="o">)</span> <span class="o">||</span> <span class="n">type</span> <span class="o">==</span> <span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nf">Long</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"boolean"</span><span class="o">)</span> <span class="o">||</span> <span class="n">type</span> <span class="o">==</span> <span class="n">Boolean</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nf">Boolean</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">type</span> <span class="o">==</span> <span class="n">Date</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">java</span><span class="o">.</span><span class="na">sql</span><span class="o">.</span><span class="na">Date</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
  
  <span class="kd">private</span> <span class="kd">static</span> <span class="n">Method</span> <span class="nf">findSetter</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">type</span><span class="o">,</span> <span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Method</span><span class="o">[]</span> <span class="n">methods</span> <span class="o">=</span> <span class="n">type</span><span class="o">.</span><span class="na">getMethods</span><span class="o">();</span>
    
    <span class="n">String</span> <span class="n">propName</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">Method</span> <span class="n">m</span> <span class="o">:</span> <span class="n">methods</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(!</span><span class="n">m</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"set"</span><span class="o">))</span> <span class="k">continue</span><span class="o">;</span>
      
      <span class="n">propName</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">substring</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">propName</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">()))</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">//VO객체</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Member</span> <span class="o">{</span>
	<span class="kd">protected</span> <span class="kt">int</span> 		<span class="n">no</span><span class="o">;</span>
	<span class="kd">protected</span> <span class="n">String</span> 	<span class="n">name</span><span class="o">;</span>
	<span class="kd">protected</span> <span class="n">String</span> 	<span class="n">email</span><span class="o">;</span>
	<span class="kd">protected</span> <span class="n">String</span> 	<span class="n">password</span><span class="o">;</span>
	<span class="kd">protected</span> <span class="n">Date</span>		<span class="n">createdDate</span><span class="o">;</span>
	<span class="kd">protected</span> <span class="n">Date</span>		<span class="n">modifiedDate</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">getNo</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">no</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">Member</span> <span class="nf">setNo</span><span class="o">(</span><span class="kt">int</span> <span class="n">no</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">no</span> <span class="o">=</span> <span class="n">no</span><span class="o">;</span>
		<span class="k">return</span> <span class="k">this</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">Member</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
		<span class="k">return</span> <span class="k">this</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getEmail</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">email</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">Member</span> <span class="nf">setEmail</span><span class="o">(</span><span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
		<span class="k">return</span> <span class="k">this</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="o">....</span>
	
<span class="o">}</span>
</code></pre>
</div>

<p><br /></p>

<h1 id="property--">2. Property를 이용한 객체관리</h1>

<p>DB소스값, 페이지 컨트롤러 위치를 프로퍼티 파일로 만들고 이를 읽어 객체를 생성하고, DI를 하는 클래스를 만든다. 이를 ContextLoaderListener의 contextInitialized()에서 프로퍼티 값을 얻는 get메서드를 만들고 프런트 컨트롤러에서 사용한다.</p>

<h4 id="section">시나리오</h4>

<ol>
  <li>웹 어플리케이션이 시작되면 서블릿 컨테이너는 ContextLoaderListener의 contextInitialized()메서드를 호출한다.</li>
  <li>contextInitialized()메서드에서는 ApplicationContext를 생성한다. 이때 생성자에 프로퍼티 파일의 경로를 매개변수로 넘겨준다.</li>
  <li>ApplicationContext는 프로퍼티 파일의 내용을 읽는다.</li>
  <li>프로퍼티 파일에 선언된 대로 객체를 생성하여 객체 테이블에 저장한다.</li>
  <li>객체 테이블에 저장된 각 객체에 대해 의존 객체를 찾아서 할당 한다.</li>
</ol>

<p>이렇게 되면 페이지 컨트롤러나 DAO를 만들 때마다 더 이상 ContextLoaderListener를 변경할 필요가 없어진다.</p>

<p><br /></p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">//application-context.properties</span>
<span class="err">#</span><span class="mi">1</span><span class="o">.</span> <span class="k">for</span> <span class="n">ApplicationContext</span><span class="o">.</span>
<span class="n">jndi</span><span class="o">.</span><span class="na">dataSource</span><span class="o">=</span><span class="nl">java:</span><span class="n">comp</span><span class="o">/</span><span class="n">env</span><span class="o">/</span><span class="n">jdbc</span><span class="o">/</span><span class="n">studydb</span>
<span class="n">memberDao</span><span class="o">=</span><span class="n">spms</span><span class="o">.</span><span class="na">dao</span><span class="o">.</span><span class="na">MySqlMemberDao</span>
<span class="o">/</span><span class="n">auth</span><span class="o">/</span><span class="n">login</span><span class="o">.</span><span class="na">do</span><span class="o">=</span><span class="n">spms</span><span class="o">.</span><span class="na">controls</span><span class="o">.</span><span class="na">LogInController</span>
<span class="o">/</span><span class="n">auth</span><span class="o">/</span><span class="n">logout</span><span class="o">.</span><span class="na">do</span><span class="o">=</span><span class="n">spms</span><span class="o">.</span><span class="na">controls</span><span class="o">.</span><span class="na">LogOutController</span>
<span class="o">/</span><span class="n">member</span><span class="o">/</span><span class="n">list</span><span class="o">.</span><span class="na">do</span><span class="o">=</span><span class="n">spms</span><span class="o">.</span><span class="na">controls</span><span class="o">.</span><span class="na">MemberListController</span>
<span class="o">/</span><span class="n">member</span><span class="o">/</span><span class="n">add</span><span class="o">.</span><span class="na">do</span><span class="o">=</span><span class="n">spms</span><span class="o">.</span><span class="na">controls</span><span class="o">.</span><span class="na">MemberAddController</span>
<span class="o">/</span><span class="n">member</span><span class="o">/</span><span class="n">update</span><span class="o">.</span><span class="na">do</span><span class="o">=</span><span class="n">spms</span><span class="o">.</span><span class="na">controls</span><span class="o">.</span><span class="na">MemberUpdateController</span>
<span class="o">/</span><span class="n">member</span><span class="o">/</span><span class="n">delete</span><span class="o">.</span><span class="na">do</span><span class="o">=</span><span class="n">spms</span><span class="o">.</span><span class="na">controls</span><span class="o">.</span><span class="na">MemberDeleteController</span>
</code></pre>
</div>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">// 프로퍼티 파일 적용 : ApplicationContext 사용</span>

<span class="nd">@WebListener</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ContextLoaderListener</span> <span class="kd">implements</span> <span class="n">ServletContextListener</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="n">ApplicationContext</span> <span class="n">applicationContext</span><span class="o">;</span>
  
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">ApplicationContext</span> <span class="nf">getApplicationContext</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">applicationContext</span><span class="o">;</span>
  <span class="o">}</span>
  
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">contextInitialized</span><span class="o">(</span><span class="n">ServletContextEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">ServletContext</span> <span class="n">sc</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">();</span>
      
      <span class="n">String</span> <span class="n">propertiesPath</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="na">getRealPath</span><span class="o">(</span>
          <span class="n">sc</span><span class="o">.</span><span class="na">getInitParameter</span><span class="o">(</span><span class="s">"contextConfigLocation"</span><span class="o">));</span>
      <span class="n">applicationContext</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ApplicationContext</span><span class="o">(</span><span class="n">propertiesPath</span><span class="o">);</span>
      
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Throwable</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
  
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">contextDestroyed</span><span class="o">(</span><span class="n">ServletContextEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{}</span>
<span class="o">}</span>
</code></pre>
</div>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">spms</span><span class="o">.</span><span class="na">context</span><span class="o">;</span>
<span class="cm">/*
만약 프로퍼티 키가 "jndi"로 시작한다면 객체를 생성하지 않고, InitialContext를 통해서 얻는다.
InitialContext의 lookup()메서드는 JNDI인터페이스를 통해 톰켓 서버에 등록된 객체를 찾는다.
그 밖의 객체는 Class.forName()을 호출하여 클래스를 로딩하고, newInstance()를 사용하여 인스턴스를 생성한다.

injectDpendency()는 "jndi."로 시작하는 톰켓서버에서 제공한 객체는 의존객체를 주입해서는 안되기 때문에 제외 했고 
그 외 객체들은 set으로 시작하는 메서드를 찾고 
그 메서드의 매개변수와 타입이 일치하는 객체를 objTable에서 찾아
셋터 메서드를 호출하는 방식이다.
*/</span>

<span class="c1">// 프로퍼티 파일을 이용한 객체 준비</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ApplicationContext</span> <span class="o">{</span>
  <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">objTable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;();</span>
  
  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getBean</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">objTable</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
  <span class="o">}</span>
  
  <span class="kd">public</span> <span class="nf">ApplicationContext</span><span class="o">(</span><span class="n">String</span> <span class="n">propertiesPath</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">Properties</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
    <span class="n">props</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="n">propertiesPath</span><span class="o">));</span>
    
    <span class="n">prepareObjects</span><span class="o">(</span><span class="n">props</span><span class="o">);</span>
    <span class="n">injectDependency</span><span class="o">();</span>
  <span class="o">}</span>
  
  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">prepareObjects</span><span class="o">(</span><span class="n">Properties</span> <span class="n">props</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">Context</span> <span class="n">ctx</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InitialContext</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">key</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    
    <span class="k">for</span> <span class="o">(</span><span class="n">Object</span> <span class="n">item</span> <span class="o">:</span> <span class="n">props</span><span class="o">.</span><span class="na">keySet</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">key</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">item</span><span class="o">;</span>
      <span class="n">value</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"jndi."</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">objTable</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">ctx</span><span class="o">.</span><span class="na">lookup</span><span class="o">(</span><span class="n">value</span><span class="o">));</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">objTable</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">value</span><span class="o">).</span><span class="na">newInstance</span><span class="o">());</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
  
  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">injectDependency</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">key</span> <span class="o">:</span> <span class="n">objTable</span><span class="o">.</span><span class="na">keySet</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(!</span><span class="n">key</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"jndi."</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">callSetter</span><span class="o">(</span><span class="n">objTable</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">));</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">callSetter</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">Object</span> <span class="n">dependency</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">Method</span> <span class="n">m</span> <span class="o">:</span> <span class="n">obj</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getMethods</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"set"</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">dependency</span> <span class="o">=</span> <span class="n">findObjectByType</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">getParameterTypes</span><span class="o">()[</span><span class="mi">0</span><span class="o">]);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">dependency</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">m</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="n">dependency</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
  
  <span class="kd">private</span> <span class="n">Object</span> <span class="nf">findObjectByType</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">Object</span> <span class="n">obj</span> <span class="o">:</span> <span class="n">objTable</span><span class="o">.</span><span class="na">values</span><span class="o">())</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">isInstance</span><span class="o">(</span><span class="n">obj</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">;</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">// 페이지 컨트롤러를 찾을 때 ApplicationContext의 사용</span>
<span class="nd">@WebServlet</span><span class="o">(</span><span class="s">"*.do"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DispatcherServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span>
      <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span>
      <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"text/html; charset=UTF-8"</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">servletPath</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getServletPath</span><span class="o">();</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">ApplicationContext</span> <span class="n">ctx</span> <span class="o">=</span> <span class="n">ContextLoaderListener</span><span class="o">.</span><span class="na">getApplicationContext</span><span class="o">();</span>
      
      <span class="c1">// 페이지 컨트롤러에게 전달할 Map 객체를 준비한다. </span>
      <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;();</span>
      <span class="n">model</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"session"</span><span class="o">,</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">());</span>
      
      <span class="n">Controller</span> <span class="n">pageController</span> <span class="o">=</span> <span class="o">(</span><span class="n">Controller</span><span class="o">)</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">servletPath</span><span class="o">);</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">pageController</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="o">(</span><span class="s">"요청한 서비스를 찾을 수 없습니다."</span><span class="o">);</span>
      <span class="o">}</span>
      
      <span class="k">if</span> <span class="o">(</span><span class="n">pageController</span> <span class="k">instanceof</span> <span class="n">DataBinding</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">prepareRequestData</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">model</span><span class="o">,</span> <span class="o">(</span><span class="n">DataBinding</span><span class="o">)</span><span class="n">pageController</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="c1">// 페이지 컨트롤러를 실행한다.</span>
      <span class="n">String</span> <span class="n">viewUrl</span> <span class="o">=</span> <span class="n">pageController</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">model</span><span class="o">);</span>
      
      <span class="c1">// Map 객체에 저장된 값을 ServletRequest에 복사한다.</span>
      <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">key</span> <span class="o">:</span> <span class="n">model</span><span class="o">.</span><span class="na">keySet</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">model</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">));</span>
      <span class="o">}</span>
      
      <span class="k">if</span> <span class="o">(</span><span class="n">viewUrl</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"redirect:"</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="n">viewUrl</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">9</span><span class="o">));</span>
        <span class="k">return</span><span class="o">;</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">RequestDispatcher</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="n">viewUrl</span><span class="o">);</span>
        <span class="n">rd</span><span class="o">.</span><span class="na">include</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
      <span class="o">}</span>
      
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
      <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"error"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
      <span class="n">RequestDispatcher</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="s">"/Error.jsp"</span><span class="o">);</span>
      <span class="n">rd</span><span class="o">.</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">prepareRequestData</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
      <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">model</span><span class="o">,</span> <span class="n">DataBinding</span> <span class="n">dataBinding</span><span class="o">)</span>
      <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">Object</span><span class="o">[]</span> <span class="n">dataBinders</span> <span class="o">=</span> <span class="n">dataBinding</span><span class="o">.</span><span class="na">getDataBinders</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">dataName</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">dataType</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="n">Object</span> <span class="n">dataObj</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dataBinders</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">+=</span><span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">dataName</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">dataBinders</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
      <span class="n">dataType</span> <span class="o">=</span> <span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;)</span> <span class="n">dataBinders</span><span class="o">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">];</span>
      <span class="n">dataObj</span> <span class="o">=</span> <span class="n">ServletRequestDataBinder</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">dataType</span><span class="o">,</span> <span class="n">dataName</span><span class="o">);</span>
      <span class="n">model</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">dataName</span><span class="o">,</span> <span class="n">dataObj</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>
<div class="language-xml highlighter-rouge"><pre class="highlight"><code>//DD파일
  <span class="c">&lt;!-- 컨텍스트 초기화 파라미터 --&gt;</span>
  <span class="nt">&lt;context-param&gt;</span>
    <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
    <span class="nt">&lt;param-value&gt;</span>/WEB-INF/application-context.properties<span class="nt">&lt;/param-value&gt;</span>
  <span class="nt">&lt;/context-param&gt;</span>
</code></pre>
</div>

<h1 id="section-1">3. 애노테이션을 이용한 객체 관리</h1>

<p>DAO나 페이지 컨트롤러에 애노테이션을 직접 규칙을 설정해 붙인다. 애노테이션의 기본값은 객체이름으로 보통한다. ApplicationContext에서 애노테이션이 붙은 클래스를 읽어 애노테이션 값을 key값으로 객체의 인스턴스를 값으로 objTable에 추가 해 이전과 같은 방식으로 작동한다.</p>

<blockquote>
  <p>애노테이션을 정의할 때 잊지 말아야할 것은 애노테이션의 유지 정책을 지정하는 것이다. <code class="highlighter-rouge">애노테이션 유지 정책</code>이란 애노테이션 정보를 언제까지 유지할 것인지 설정하는 문법이다.</p>
  <blockquote>

    <table>
      <thead>
        <tr>
          <th>정책</th>
          <th>설명</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>RetentionPolicy.SOURCE</td>
          <td>소스 파일에서만 유지, 컴파일할 때 제거됨, 즉 클래스 파일에 애노테이션 정보가 남아 있지 않음</td>
        </tr>
        <tr>
          <td>RetentionPolicy.CLASS</td>
          <td>클래스 파일에 기록됨, 실행시에는 유지되지 않음, 즉 실행 중에서는 클래스에 기록된 애노테이션 값을 꺼낼 수 없음(기본 정책)</td>
        </tr>
        <tr>
          <td>RetentionPolicy.RUNTIME</td>
          <td>클래스 파일에 기록됨, 실행시에도 유지됨, 즉 실행 중에 클래스에 기록된 애노테이션 값을 참조할 수 있음</td>
        </tr>
      </tbody>
    </table>
  </blockquote>
</blockquote>

<p><br /></p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">spms</span><span class="o">.</span><span class="na">annotation</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.annotation.Retention</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.annotation.RetentionPolicy</span><span class="o">;</span>

<span class="nd">@Retention</span><span class="o">(</span><span class="n">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="n">Component</span> <span class="o">{</span>
  <span class="n">String</span> <span class="nf">value</span><span class="o">()</span> <span class="k">default</span> <span class="s">""</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="cm">/*
애노테이션이 붙은 클래스를 찾기 위해 'Reflections'라는 오픈소스사용
*/</span>

<span class="c1">// 프로퍼티 파일 및 애노테이션을 이용한 객체 준비</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ApplicationContext</span> <span class="o">{</span>
  <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">objTable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;();</span>
  
  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getBean</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">objTable</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
  <span class="o">}</span>
  
  <span class="kd">public</span> <span class="nf">ApplicationContext</span><span class="o">(</span><span class="n">String</span> <span class="n">propertiesPath</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">Properties</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
    <span class="n">props</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="n">propertiesPath</span><span class="o">));</span>
    
    <span class="n">prepareObjects</span><span class="o">(</span><span class="n">props</span><span class="o">);</span>
    <span class="n">prepareAnnotationObjects</span><span class="o">();</span>
    <span class="n">injectDependency</span><span class="o">();</span>
  <span class="o">}</span>
  
  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">prepareAnnotationObjects</span><span class="o">()</span> 
      <span class="kd">throws</span> <span class="n">Exception</span><span class="o">{</span>
    <span class="n">Reflections</span> <span class="n">reflector</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Reflections</span><span class="o">(</span><span class="s">""</span><span class="o">);</span>
    
    <span class="n">Set</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">reflector</span><span class="o">.</span><span class="na">getTypesAnnotatedWith</span><span class="o">(</span><span class="n">Component</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">key</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">for</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">key</span> <span class="o">=</span> <span class="n">clazz</span><span class="o">.</span><span class="na">getAnnotation</span><span class="o">(</span><span class="n">Component</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">value</span><span class="o">();</span>
      <span class="n">objTable</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">clazz</span><span class="o">.</span><span class="na">newInstance</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
  
  <span class="o">....</span>
  
</code></pre>
</div>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">// Annotation 적용</span>
<span class="nd">@Component</span><span class="o">(</span><span class="s">"/member/list.do"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberListController</span> <span class="kd">implements</span> <span class="n">Controller</span> <span class="o">{</span>
  <span class="n">MemberDao</span> <span class="n">memberDao</span><span class="o">;</span>
  
  <span class="kd">public</span> <span class="n">MemberListController</span> <span class="nf">setMemberDao</span><span class="o">(</span><span class="n">MemberDao</span> <span class="n">memberDao</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">memberDao</span> <span class="o">=</span> <span class="n">memberDao</span><span class="o">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">execute</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">model</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">model</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"members"</span><span class="o">,</span> <span class="n">memberDao</span><span class="o">.</span><span class="na">selectList</span><span class="o">());</span>
    <span class="k">return</span> <span class="s">"/member/MemberList.jsp"</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p><br /></p>

<p>JNDI객체나 외부 라이브러리에 들어 있는 객체는 애노테이션을 적용할 수 없기 때문에 프로퍼티 파일에 등록해서 사용한다.</p>

<h3 id="reference">Reference</h3>
<ul>
  <li><a href="http://www.yes24.com/24/Goods/13159413?Acode=101">열혈강의 자바 웹 개발 워크북</a></li>
  <li><a href="http://gyrfalcon.tistory.com/entry/Java-Reflection">Minsub’s Blog</a></li>
</ul>

        </article>
        <hr>

        
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
        

        <div class="post-recent">
    <div class="pre">
        
        <p><strong>prev</strong> <a href="/2016/09/16/frontcontroller_dietc/">프런트 컨트롤러 패턴과 의존성주입</a></p>
        
    </div>
    <div class="nex">

        
        <p><strong>next</strong> <a href="/2016/09/18/mybatis/">mybatis 개론</a></p>
        
    </div>
</div>


        <h2 id="comments">Comments</h2>
        


<div id="disqus_thread"></div>
<script>
    /**
     * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */

    var disqus_config = function() {
        this.page.url = 'http://joswlv.github.io/2016/09/17/reflection_property/'; // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://joswlv.github.io/2016/09/17/reflection_property/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };

    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document,
            s = d.createElement('script');

        s.src = '//joswlv.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>




    </div>
    <button class="anchor"><i class="fa fa-anchor"></i></button>
    <div class="right">
        <div class="wrap">

            <!-- Content -->
            <div class="side content">
                <div>
                    Content
                </div>
                <ul id="content-side" class="content-ul">
                    <li><a href="#similar_posts">Similar Posts</a></li>
                    <li><a href="#comments">Comments</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<script>
/**
 * target _blank
 */
(function() {
    var aTags = document.querySelectorAll('article a:not([id])')
    for (var i = 0; i < aTags.length; i++) {
        aTags[i].setAttribute('target', '_blank')
    }
}());
</script>
<script src="/js/pageContent.js " charset="utf-8"></script>


    <footer class="site-footer">


    <div class="wrapper">

        <p class="description">
            
        </p>
        <p class="contact">
            Contact me at: 
            <a href="https://github.com/joswlv" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a>  
            <a href="mailto:wh7923@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>     
            <a href="https://www.facebook.com/wsj7923" title="Facebook"><i class="fa fa-facebook-official" aria-hidden="true"></i></a>    
        </p>
        <p>
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>
        </p>
    </div>
</footer>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <div class="back-to-top">
    <a href="#top" class="scroll">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/scroll.min.js " charset="utf-8"></script>
  </body>

</html>
