<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="Jo Blog">
    <meta property="og:description" content="Jo Seungwan Blog!~~!">
    <meta property="og:image" content="https://raw.githubusercontent.com/joswlv/joswlv.github.io/master/bg.jpg">
    <meta property="og:url" content="https://joswlv.github.io">

    <title>Joswlv</title>
    <meta name="description" content="">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href="/css/fontawesome/css/font-awesome.min.css ">
    <link rel="stylesheet" href="/css/main.css ">
    <link rel="canonical" href="http://joswlv.github.io/">
    <link rel="alternate" type="application/rss+xml" title="Joswlv" href="http://joswlv.github.io/feed.xml ">



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83868242-1', 'auto');
  ga('send', 'pageview');

</script>

</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">Joswlv</a>
        <small></small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a class="active" href="/">
                        
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>

                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" index>
    <div class="left">
        <!-- <h1>Welcome to SW's Blog!</h1>
        <small></small> -->
        <hr>
        <ul>
            
              <li>
                <h2>
                  <a class="post-link" href="/2017/04/08/garbagecollectionpauses/">Garbage collection pauses</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-04-08
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Cassandra" title="Category: Cassandra" rel="category">Cassandra</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                </div>
                <div class="excerpt">
                    <h1 id="section">장애현상</h1>

<p><strong>Using cassandra version : 2.1.8</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>WARN  [GossipTasks:1] 2017-03-21 17:11:05,462 FailureDetector.java:249 - Not marking nodes down due to local pause of 9594745097 &gt; 5000000000
INFO  [GossipTasks:1] 2017-03-21 17:11:05,462 Gossiper.java:968 - InetAddress /10.161.26.248 is now DOWN
INFO  [Service Thread] 2017-03-21 17:11:05,463 GCInspector.java:252 - ConcurrentMarkSweep GC in 9487ms.  CMS Old Gen: 3039553840 -&gt; 3027311712; Par Eden Space: 833093632 -&gt; 0; Par Survivor Space: 46277016 -&gt; 0
</code></pre>
</div>

<p>이런 로그를 찍고 서버가 <code class="highlighter-rouge">down</code> 되었다 살았다를 반복하였다.</p>

<h1 id="section-1">원인</h1>

<ul>
  <li><a href="https://docs.datastax.com/en/landing_page/doc/landing_page/troubleshooting/cassandra/gcPauses.html">https://docs.datastax.com/en/landing_page/doc/landing_page/troubleshooting/cassandra/gcPauses.html</a></li>
</ul>

<p><code class="highlighter-rouge">Garbage collection pause</code>라고 한다. 이 현상이 있으면 해당 노드가 다른 노드에 down 된 것처럼 보일 수 있다고 한다.</p>

<p>원인은 아래 4가지 정도가 있다고 한다.</p>

<ul>
  <li>If the problem is recent, check for any recent applications changes.</li>
  <li>Excessive tombstone activity: often caused by heavy delete workloads.</li>
  <li>Large row updates or large batch updates: reduce the size of the individual write below 1 Mb (at the most).</li>
  <li>Extremely wide rows: manifests as problems in repairs, selects, caching, and elsewhere.</li>
</ul>

<p>지금 운영 중인 카산드라 특성상 비슷한 TTL이 걸려 있는 데이터들이 많은데, 한달전에 인입된 데이터가 <code class="highlighter-rouge">heavy delete</code>되면서 발생한 문제인것으로 추측한다.</p>

<p><code class="highlighter-rouge">Not marking nodes down due to local pause</code> 로그는 pause 현상이 너무 오래 지속되었을 때 node down이 계속 된 것처럼 보이기 때문에 client에서 심각한 에러가 발생했다고 볼 수 있어서 최대 시간(5초) 보다 크면 node down 표시를 skip 하겠다 라고 알려주는 로그라고한다.</p>

<p><code class="highlighter-rouge">Garbage collection pause</code>현상은 <code class="highlighter-rouge">2.1.6</code>버전 부터 패치되어 최대시간(5초)동안 서버가 down되었다 살았다를 반복한다.</p>

<p><a href="https://issues.apache.org/jira/browse/CASSANDRA-9183">https://issues.apache.org/jira/browse/CASSANDRA-9183</a></p>

<h1 id="section-2">해결방안</h1>

<p>해결 방안은 크게 두가지 방법이 존재한다.</p>

<ol>
  <li>Java 1.7부터 도입된 G1 방식으로 튜닝</li>
  <li>Cassandra 메모리 설정을 바꾸는 방법</li>
</ol>

<p>1번은 현재 사용하고 있는 CMS GC방식이 아닌 Java 1.7부터 도입된 G1 방식으로 튜닝한다.</p>

<p><strong><a href="https://medium.com/@mlowicki/move-cassandra-2-1-to-g1-garbage-collector-b9fb27365509">https://medium.com/@mlowicki/move-cassandra-2-1-to-g1-garbage-collector-b9fb27365509</a></strong></p>

<p>datastax 에서는 2번 방법 위주로 튜닝 가이드를 제공하고 있다.
<code class="highlighter-rouge">MAX_HEAP_SIZE</code>, <code class="highlighter-rouge">HEAP_NEWSIZE</code>를 조정하는 방법이다.</p>

<p><strong><a href="https://docs.datastax.com/en/cassandra/2.1/cassandra/operations/ops_tune_jvm_c.html">https://docs.datastax.com/en/cassandra/2.1/cassandra/operations/ops_tune_jvm_c.html</a></strong></p>

<p><code class="highlighter-rouge">cassandra-env.sh</code> 설정을 보면 이런 계산식에 의해 default 세팅이 되어 있다.</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">MAX_HEAP_SIZE</code> = max(min(1/2 ram, 1024MB), min(1/4 ram, 8GB))</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">HEAP_NEWSIZE</code> = min(max_sensible_per_modern_cpu_core * num_cores, 1/4 * heap size)  <br />
(max_sensible_per_modern_cpu_core 는 100으로 세팅됨)</p>
  </li>
</ul>

<p>카산드라 서버들이 모두 24 CPU core, 16G 메모리를 가지고 있으므로
<code class="highlighter-rouge">MAX_HEAP_SIZE</code>는 4G, <code class="highlighter-rouge">HEAP_NEWSIZE</code>는 1G 로 세팅되어 있다.</p>

<p>datastax 가이드 추천대로라면
<code class="highlighter-rouge">MAX_HEAP_SIZE</code>= 8G,  <code class="highlighter-rouge">HEAP_NEWSIZE</code>=2G 정도까지 늘릴 수 있을 것 같다.
그리고 현재 서버 메모리를 40%정도만 사용하고 있으므로 큰 영향은 없을 것 같다.</p>


                </div>
                <div class="read-all">
                    <a  href="/2017/04/08/garbagecollectionpauses/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2017/04/02/runtojarbackground/">jar 백그라운드로 실행하기</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-04-02
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Etc" title="Category: Etc" rel="category">Etc</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                </div>
                <div class="excerpt">
                    <h1 id="jar--">Jar 백그라운드로 실행하기</h1>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="nv">JARFile</span><span class="o">=</span><span class="s2">"KafkaOffsetMonitor-assembly-0.2.1.jar"</span>
<span class="nv">DIR</span><span class="o">=</span><span class="s2">"/home1/irteam/seungwan"</span>
<span class="k">function </span>start <span class="o">{</span>
    <span class="k">if </span>pkill -0 -f <span class="nv">$JARFile</span> &gt; /dev/null 2&gt;&amp;1
    <span class="k">then </span><span class="nb">echo</span> <span class="s2">"Service [</span><span class="nv">$JARFile</span><span class="s2">] is already running. Ignoring startup request/"</span>
      <span class="nb">exit </span>1
    <span class="k">fi
    </span><span class="nb">echo</span> <span class="s2">"Staring [</span><span class="nv">$JARFile</span><span class="s2">] Application!!"</span>
    nohup java -cp KafkaOffsetMonitor-assembly-0.2.1.jar com.quantifind.kafka.offsetapp.OffsetGetterWeb --zk tcambkaf-91b901.svr.toastmaker.net,tcambkaf-91b902.svr.toastmaker.net --port 8080 --refresh 10.seconds --retain 2.days&gt; <span class="nv">$DIR</span>/log.txt 2&gt;&amp;1 &amp;

<span class="o">}</span>

<span class="k">function </span>stop <span class="o">{</span>
    <span class="k">if</span> ! pkill -0 -f <span class="nv">$JARFile</span> &gt; /dev/null 2&gt;&amp;1
    <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"Service [</span><span class="nv">$JARFile</span><span class="s2">] is not running. Ignoring shutdown request."</span>
        <span class="k">return </span>0
    <span class="k">fi

    </span><span class="nb">echo</span> <span class="s2">"Stopping [</span><span class="nv">$JARFile</span><span class="s2">]!!"</span>

    <span class="c"># First, we will try to trigger a controlled shutdown using</span>

    <span class="c"># Wait until the server process has shut down</span>
    <span class="nv">attempts</span><span class="o">=</span>0
    <span class="k">while </span>pkill -0 -f <span class="nv">$JARFile</span> &gt; /dev/null 2&gt;&amp;1
    <span class="k">do
        </span><span class="nv">attempts</span><span class="o">=</span><span class="nv">$[$attempts</span> + 1]
        <span class="k">if</span> <span class="o">[</span> <span class="nv">$attempts</span> -gt 5 <span class="o">]</span>
        <span class="k">then</span>
            <span class="c"># We have waited too long. Kill it.</span>
            pkill -f <span class="nv">$JARFile</span> &gt; /dev/null 2&gt;&amp;1
        <span class="k">fi
        </span>sleep 1s
    <span class="k">done
    </span><span class="nb">echo</span> <span class="s2">"Stop [</span><span class="nv">$JARFile</span><span class="s2">] is completed!!"</span>
<span class="o">}</span>

<span class="k">function </span>status <span class="o">{</span>
    <span class="k">if </span>pkill -0 -f <span class="nv">$JARFile</span> &gt; /dev/null 2&gt;&amp;1
    <span class="k">then </span><span class="nb">echo</span> <span class="s2">"Service [</span><span class="nv">$JARFile</span><span class="s2">] is running."</span>
      <span class="nb">exit </span>1
    <span class="k">fi
    </span><span class="nb">echo</span> <span class="s2">"Service [</span><span class="nv">$JARFile</span><span class="s2">] is not running"</span>
<span class="o">}</span>

<span class="k">case</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="k">in
  </span>status<span class="p">)</span>
    status
    <span class="p">;;</span>
  stop<span class="p">)</span>
        stop
    <span class="p">;;</span>
  start<span class="p">)</span>
        start
    <span class="p">;;</span>
  restart<span class="p">)</span>
    stop
    start
    <span class="p">;;</span>
  <span class="k">*</span><span class="p">)</span>
    <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> {start|stop|restart|status}"</span>
    <span class="nb">exit </span>1
<span class="k">esac

</span><span class="nb">exit </span>0
</code></pre>
</div>

<ul>
  <li><code class="highlighter-rouge">/dev/null</code>은 어디에도 콘솔로그를 출력하지 않겠다는 뜻</li>
  <li><code class="highlighter-rouge">2&gt;&amp;1</code>은 표준에러는 표준출력에 출력하겠다는 뜻</li>
  <li><code class="highlighter-rouge">$DIR/log.txt 2&gt;&amp;1</code>은 표준에러를 파일에 적지 않고 콘솔에 출력하겠다는 뜻 이렇게 2&gt;&amp;1 리다이렉션을 시켜 줌으로 인해 stderr &gt; stdout 으로 출력이 되고 log.txt파일에 기록됨</li>
  <li><code class="highlighter-rouge">nohup</code>명령어는 프로세스 중단(hangup)을 무시하고 명령어를 실행한다는 뜻</li>
  <li><code class="highlighter-rouge">nohup</code>명령어 끝에 <code class="highlighter-rouge">&amp;</code>를 추가 하면 백그라운드로 실행</li>
  <li><code class="highlighter-rouge">&gt; /dev/null 2&gt;&amp;1</code>도 있는데, 이는 표준 출력을 무시하고, 표준에러만 화면에 출력하겠다는 뜻</li>
  <li><code class="highlighter-rouge">&gt;</code>연산자는 redirection을 의미함</li>
</ul>

<h3 id="reference">Reference</h3>

<ul>
  <li><a href="http://reebok.tistory.com/56">http://reebok.tistory.com/56</a></li>
  <li><a href="https://www.xaprb.com/blog/2006/06/06/what-does-devnull-21-mean/">https://www.xaprb.com/blog/2006/06/06/what-does-devnull-21-mean/</a></li>
</ul>

                </div>
                <div class="read-all">
                    <a  href="/2017/04/02/runtojarbackground/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2017/03/27/mavenbuildplugin/">Maven Build Plugin & 옵션</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-03-27
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Etc" title="Category: Etc" rel="category">Etc</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                </div>
                <div class="excerpt">
                    <h1 id="maven-build-plugin">Maven Build Plugin</h1>

<h2 id="resource---">1. 디렉토리에 Resource 디렉토리 추가 방법</h2>

<p>Maven 빌드를 할때, <code class="highlighter-rouge">src</code> 이외에 디록토리를 추가가 필요 할때가 있다.</p>

<p>방법은 다음과 같다.</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;build&gt;</span>
<span class="nt">&lt;resources&gt;</span>
	<span class="nt">&lt;resource&gt;</span>
		<span class="nt">&lt;directory&gt;</span>bin<span class="nt">&lt;/directory&gt;</span>
		<span class="nt">&lt;targetPath&gt;</span>${basedir}/target/bin<span class="nt">&lt;/targetPath&gt;</span>
	<span class="nt">&lt;/resource&gt;</span>
	<span class="nt">&lt;resource&gt;</span>
		<span class="nt">&lt;directory&gt;</span>conf<span class="nt">&lt;/directory&gt;</span>
		<span class="nt">&lt;targetPath&gt;</span>${basedir}/target/conf<span class="nt">&lt;/targetPath&gt;</span>
	<span class="nt">&lt;/resource&gt;</span>
<span class="nt">&lt;/resources&gt;</span>

...

<span class="nt">&lt;/build&gt;</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">bin</code>, <code class="highlighter-rouge">conf</code> 디렉토리를 빌드 할때 함께 추가한다고 명시하면된다.</p>

<h2 id="jar----">2. 빌드한 jar를 저장 위치를 변경하는 법</h2>

<p><code class="highlighter-rouge">src</code>디렉토리의 java파일을 컴파일해 만들어진 jar파일은 기본 /target아래에 만들어진다.</p>

<p>이 위치를 변경하고 싶으면 다음과 같다.</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;build&gt;</span>
	<span class="nt">&lt;plugins&gt;</span>
		<span class="nt">&lt;plugin&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>maven-jar-plugin<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;configuration&gt;</span>
				<span class="nt">&lt;outputDirectory&gt;</span>${basedir}/target/lib<span class="nt">&lt;/outputDirectory&gt;</span>
			<span class="nt">&lt;/configuration&gt;</span>
		<span class="nt">&lt;/plugin&gt;</span>
	<span class="nt">&lt;/plugins&gt;</span>

...

<span class="nt">&lt;/build&gt;</span>
</code></pre>
</div>

<h2 id="dependency--jar-">3. dependency를 포함한 jar 만들기</h2>

<p>이 방법은 여러가지가 있다. 그 중 assembly plugin을 사용하면 다음과 같다.</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;plugin&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>maven-assembly-plugin<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;descriptorRefs&gt;</span>
            <span class="nt">&lt;descriptorRef&gt;</span>jar-with-dependencies<span class="nt">&lt;/descriptorRef&gt;</span>
        <span class="nt">&lt;/descriptorRefs&gt;</span>
    <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;executions&gt;</span>
        <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;id&gt;</span>make-assembly<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;phase&gt;</span>package<span class="nt">&lt;/phase&gt;</span>
            <span class="nt">&lt;goals&gt;</span>
                <span class="nt">&lt;goal&gt;</span>single<span class="nt">&lt;/goal&gt;</span>
            <span class="nt">&lt;/goals&gt;</span>
        <span class="nt">&lt;/execution&gt;</span>
    <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre>
</div>

<h2 id="dependency-jar----">4. dependency jar를 모아 저장해 빌드하는 법</h2>

<p>dependency에 있는 라이브러리 jar파일을 사용자가 지정한 디렉토리에 저장하는 방법은 다음과 같다.</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;plugin&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>maven-dependency-plugin<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;executions&gt;</span>
		<span class="nt">&lt;execution&gt;</span>
			<span class="nt">&lt;id&gt;</span>copy-dependencies<span class="nt">&lt;/id&gt;</span>
			<span class="nt">&lt;phase&gt;</span>package<span class="nt">&lt;/phase&gt;</span>
			<span class="nt">&lt;goals&gt;</span>
				<span class="nt">&lt;goal&gt;</span>copy-dependencies<span class="nt">&lt;/goal&gt;</span>
			<span class="nt">&lt;/goals&gt;</span>
			<span class="nt">&lt;configuration&gt;</span>
				<span class="nt">&lt;outputDirectory&gt;</span>${basedir}/target/lib<span class="nt">&lt;/outputDirectory&gt;</span>
				<span class="nt">&lt;overWriteReleases&gt;</span>false<span class="nt">&lt;/overWriteReleases&gt;</span>
				<span class="nt">&lt;overWriteSnapshots&gt;</span>false<span class="nt">&lt;/overWriteSnapshots&gt;</span>
				<span class="nt">&lt;overWriteIfNewer&gt;</span>true<span class="nt">&lt;/overWriteIfNewer&gt;</span>
			<span class="nt">&lt;/configuration&gt;</span>
		<span class="nt">&lt;/execution&gt;</span>
	<span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre>
</div>
<h1 id="alpha-beta-real--resources-dir">alpha, beta, real에 따라 resources dir구분하기</h1>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;properties&gt;</span>
	<span class="nt">&lt;maven.resources.overwrite&gt;</span>true<span class="nt">&lt;/maven.resources.overwrite&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
<span class="nt">&lt;profiles&gt;</span>
	<span class="nt">&lt;profile&gt;</span>
		<span class="nt">&lt;id&gt;</span>dev<span class="nt">&lt;/id&gt;</span>
		<span class="nt">&lt;properties&gt;</span>
			<span class="nt">&lt;env&gt;</span>dev<span class="nt">&lt;/env&gt;</span>
		<span class="nt">&lt;/properties&gt;</span>
	<span class="nt">&lt;/profile&gt;</span>

	<span class="nt">&lt;profile&gt;</span>
		<span class="nt">&lt;id&gt;</span>alpha<span class="nt">&lt;/id&gt;</span>
		<span class="nt">&lt;properties&gt;</span>
			<span class="nt">&lt;env&gt;</span>alpha<span class="nt">&lt;/env&gt;</span>
		<span class="nt">&lt;/properties&gt;</span>
	<span class="nt">&lt;/profile&gt;</span>

	<span class="nt">&lt;profile&gt;</span>
		<span class="nt">&lt;id&gt;</span>beta<span class="nt">&lt;/id&gt;</span>
		<span class="nt">&lt;properties&gt;</span>
			<span class="nt">&lt;env&gt;</span>beta<span class="nt">&lt;/env&gt;</span>
		<span class="nt">&lt;/properties&gt;</span>
	<span class="nt">&lt;/profile&gt;</span>

	<span class="nt">&lt;profile&gt;</span>
		<span class="nt">&lt;id&gt;</span>real<span class="nt">&lt;/id&gt;</span>
		<span class="nt">&lt;properties&gt;</span>
			<span class="nt">&lt;env&gt;</span>real<span class="nt">&lt;/env&gt;</span>
			<span class="nt">&lt;value&gt;</span>real<span class="nt">&lt;/value&gt;</span>
		<span class="nt">&lt;/properties&gt;</span>
	<span class="nt">&lt;/profile&gt;</span>
<span class="nt">&lt;/profiles&gt;</span>

<span class="nt">&lt;build&gt;</span>
	<span class="nt">&lt;finalName&gt;</span>DMP-DATA-API<span class="nt">&lt;/finalName&gt;</span>
	<span class="nt">&lt;resources&gt;</span>
		<span class="nt">&lt;resource&gt;</span>
			<span class="nt">&lt;directory&gt;</span>src/main/resources<span class="nt">&lt;/directory&gt;</span>
		<span class="nt">&lt;/resource&gt;</span>
		<span class="nt">&lt;resource&gt;</span>
			<span class="nt">&lt;directory&gt;</span>src/main/resources-${env}<span class="nt">&lt;/directory&gt;</span>
		<span class="nt">&lt;/resource&gt;</span>
	<span class="nt">&lt;/resources&gt;</span>
	...
<span class="nt">&lt;/build&gt;</span>
</code></pre>
</div>

<p>profile에 변수를 등록하고 <code class="highlighter-rouge">&lt;resource&gt;</code>에 <code class="highlighter-rouge">directory</code>path만 적어 주면 된다.</p>

<p>resource diretory가 하나로 합쳐지면서 같은 파일명은 <code class="highlighter-rouge">resources-${env}</code>의 파일 명으로 overwrite 된다. 
그 이유는 순차적을 실행되면서 overwrite 되기 때문이다.
(<code class="highlighter-rouge">&lt;maven.resources.overwrite&gt;true&lt;/maven.resources.overwrite&gt;</code> 이 조건을 추가 해서..)</p>

<p>아래와 같이 resources폴더를 구성하고 <code class="highlighter-rouge">mvn clean package -P real</code>을 하면 순차적으로 copy되는 것을 확인 할 수 있다.</p>

<p><br /></p>

<p><img src="http://joswlv.github.io/images/maven_directory.png" alt="" /></p>

<div class="highlighter-rouge"><pre class="highlight"><code>[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ dmp-data-api ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] Copying 6 resources		//resources
[INFO] Copying 3 resources		//resources-${env}
</code></pre>
</div>


                </div>
                <div class="read-all">
                    <a  href="/2017/03/27/mavenbuildplugin/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2017/03/26/properties/">properties 설정 및 사용</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-03-26
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Java" title="Category: Java" rel="category">Java</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                </div>
                <div class="excerpt">
                    <h1 id="properties-">Properties 사용하기</h1>

<p><code class="highlighter-rouge">properties</code>는 <code class="highlighter-rouge">Hashtable</code>를 상속받아 Key value로 구성 되어 있다.</p>

<p>key와 value를 <code class="highlighter-rouge">=</code>으로 구분한다.</p>

<p>다음은 properties 파일의 예이다.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>spark.network.timeout=800
spark.driver.memory=1G
spark.executor.memory=1G
spark.rdd.compress=true
spark.storage.memoryFraction=1
spark.core.connection.ack.wait.timeout=600
spark.akka.frameSize=50
spark.streaming.backpressure.enabled=true
spark.serializer=org.apache.spark.serializer.KryoSerializer
</code></pre>
</div>

<p>이런식으로 <code class="highlighter-rouge">=</code>를 사용하여, 구분 짓는다.</p>

<p>다음은 properties파일을 읽는 모듈이다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="n">Properties</span> <span class="nf">getProperties</span><span class="o">(</span><span class="n">String</span> <span class="n">configFilePath</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Properties</span> <span class="n">prop</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
        <span class="n">InputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">prop</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="n">configFilePath</span><span class="o">));</span>
        <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Error &gt;&gt;&gt;&gt;&gt; can't read the configFilePath =&gt; "</span> <span class="o">+</span> <span class="n">configFilePath</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(-</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span><span class="k">finally</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">in</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
                    <span class="n">in</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{}</span>
            <span class="k">finally</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">prop</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre>
</div>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">ele</span> <span class="o">:</span> <span class="n">DefaultSetting</span><span class="o">.</span><span class="na">getProperties</span><span class="o">(</span><span class="s">"resources/sites.txt"</span><span class="o">).</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">((</span><span class="n">String</span><span class="o">)</span> <span class="n">ele</span><span class="o">.</span><span class="na">getKey</span><span class="o">()</span> <span class="o">+</span><span class="s">" ==&gt; "</span><span class="o">+</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">ele</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
        <span class="o">}</span>
</code></pre>
</div>

<p>이런식으로 HashMap에 넣어서 사용하면 편리하다.</p>


                </div>
                <div class="read-all">
                    <a  href="/2017/03/26/properties/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2017/03/01/stringbuildervsstringbuffer/">StringBuilder vs StringBuffer</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-03-01
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Java" title="Category: Java" rel="category">Java</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                </div>
                <div class="excerpt">
                    <h1 id="stringbuilder-vs-stringbuffer">StringBuilder vs StringBuffer</h1>

<h3 id="section">단일 쓰레드환경에서 속도 비교</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="cm">/**
 * Buffers : 9
 * Builder : 4
 * strings:21756
 *
 * 단일 쓰레드 환경에서는 StringBuilder가 가장빠르다.
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StringSpeedTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>


        <span class="kt">long</span> <span class="n">t0</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>

        <span class="n">t0</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="n">StringBuffer</span> <span class="n">buf</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
            <span class="n">buf</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"some string"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Buffers : "</span><span class="o">+(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">t0</span><span class="o">));</span>

        <span class="n">t0</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="n">StringBuilder</span> <span class="n">building</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
            <span class="n">building</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"some string"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Builder : "</span><span class="o">+(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">t0</span><span class="o">));</span>

        <span class="n">String</span> <span class="n">withString</span> <span class="o">=</span><span class="s">""</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
            <span class="n">withString</span><span class="o">+=</span><span class="s">"some string"</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"strings:"</span> <span class="o">+</span> <span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">t0</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>StringBuilder가 가장 좋은 성능을 보여줬다.</p>

<h3 id="section-1">멀티쓰레드환경에서 비교</h3>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="cm">/**
 * Created by Jo_seungwan on 2017. 3. 1..
 * StringBuilder는 java.lang.ArrayIndexOutOfBoundsException을 출력한다.
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StringMultiThreadTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">ThreadPoolExecutor</span> <span class="n">executorService</span> <span class="o">=</span> <span class="o">(</span><span class="n">ThreadPoolExecutor</span><span class="o">)</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
        <span class="c1">//With Buffer</span>
        <span class="n">StringBuffer</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
            <span class="n">executorService</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">AppendableRunnable</span><span class="o">(</span><span class="n">buffer</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="n">shutdownAndAwaitTermination</span><span class="o">(</span><span class="n">executorService</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">" Thread Buffer : "</span><span class="o">+</span> <span class="n">AppendableRunnable</span><span class="o">.</span><span class="na">time</span><span class="o">);</span>

        <span class="c1">//With Builder</span>
        <span class="n">AppendableRunnable</span><span class="o">.</span><span class="na">time</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="n">executorService</span> <span class="o">=</span> <span class="o">(</span><span class="n">ThreadPoolExecutor</span><span class="o">)</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
        <span class="n">StringBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
            <span class="n">executorService</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">AppendableRunnable</span><span class="o">(</span><span class="n">builder</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="n">shutdownAndAwaitTermination</span><span class="o">(</span><span class="n">executorService</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">" Thread Builder: "</span><span class="o">+</span> <span class="n">AppendableRunnable</span><span class="o">.</span><span class="na">time</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">static</span> <span class="kt">void</span> <span class="nf">shutdownAndAwaitTermination</span><span class="o">(</span><span class="n">ExecutorService</span> <span class="n">pool</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">pool</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span> <span class="c1">// code reduced from Official Javadoc for Executors</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">pool</span><span class="o">.</span><span class="na">awaitTermination</span><span class="o">(</span><span class="mi">60</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">pool</span><span class="o">.</span><span class="na">shutdownNow</span><span class="o">();</span>
                <span class="k">if</span> <span class="o">(!</span><span class="n">pool</span><span class="o">.</span><span class="na">awaitTermination</span><span class="o">(</span><span class="mi">60</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">))</span>
                    <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Pool did not terminate"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">AppendableRunnable</span><span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">Appendable</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>

    <span class="kd">static</span> <span class="kt">long</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="n">T</span> <span class="n">appendable</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">AppendableRunnable</span><span class="o">(</span><span class="n">T</span> <span class="n">appendable</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">appendable</span> <span class="o">=</span> <span class="n">appendable</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
        <span class="kt">long</span> <span class="n">t0</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">10000</span> <span class="o">;</span> <span class="n">j</span><span class="o">++){</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">appendable</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"some string"</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{}</span>
        <span class="o">}</span>
        <span class="n">time</span><span class="o">+=(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">t0</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>멀티 쓰레드환경에서 10000개를 append하는 작업에서 <code class="highlighter-rouge">StringBuffer</code>속도는 느렸다.</p>

<p>그 이유는 JIT / hotspot / compiler / 무언가가 잠금을 검사 할 필요가 없다는 것을 탐지 할 때 최적화를 수행하기 때문이다.</p>

<p>이에 반해 <code class="highlighter-rouge">StringBuilder</code>는 java.lang.ArrayIndexOutOfBoundsException을 출력한다.</p>

<h3 id="section-2">정리</h3>

<table>
  <thead>
    <tr>
      <th>구분</th>
      <th>StringBuffer</th>
      <th>StringBuilder</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>synchronized</td>
      <td>Yes</td>
      <td>No</td>
    </tr>
    <tr>
      <td>Thread-safe</td>
      <td>Yes</td>
      <td>No</td>
    </tr>
    <tr>
      <td>performance</td>
      <td>Slow</td>
      <td>Better than StringBuffer</td>
    </tr>
  </tbody>
</table>

                </div>
                <div class="read-all">
                    <a  href="/2017/03/01/stringbuildervsstringbuffer/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2017/02/26/basicrdd/">기본 RDD연산들(트랜스포메이션, 액션)</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-02-26
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Spark" title="Category: Spark" rel="category">Spark</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                </div>
                <div class="excerpt">
                    <h1 id="rdd-">기본 RDD 트랜스포메이션</h1>

<h3 id="rdd--rdd-"><strong>{1,2,3,3}을 가지고 있는 RDD에 대한 RDD 트랜스포메이션</strong></h3>

<table>
  <thead>
    <tr>
      <th>함수 이름</th>
      <th>용도</th>
      <th>예</th>
      <th>결과</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>map()</td>
      <td>RDD의 각 요소에 함수를 적용하고 결과 RDD를 되돌려준다.</td>
      <td>rdd.map(x -&gt; x+1)</td>
      <td>{2,3,4,4}</td>
    </tr>
    <tr>
      <td>flatMap()</td>
      <td>RDD의 각 요소에 함수를 적용하고 반환된 반복자의 내용들로 이루어진 RDD를 되될려준다. 종종 단어 분해를 위해 쓰인다.</td>
      <td>rdd.flatMap(x -&gt; x.to(3))</td>
      <td>{1,2,3,2,3,3}</td>
    </tr>
    <tr>
      <td>filter()</td>
      <td>filter()로 전달된 함수의 조건을 통과한 값으로만 이루어진 RDD를 되돌려 준다.</td>
      <td>rdd.filter(x -&gt; x != 1)</td>
      <td>{2,3,3}</td>
    </tr>
    <tr>
      <td>distinct()</td>
      <td>중복제거</td>
      <td>rdd.distinct()</td>
      <td>{1,2,3}</td>
    </tr>
    <tr>
      <td>sample(withReplacement, fraction, [seed])</td>
      <td>복원 추출(withReplacement-true)이나 비복원 추출로 RDD에서 표본을 뽑아낸다.</td>
      <td>rdd.sample(false, 0.5)</td>
      <td>생략</td>
    </tr>
  </tbody>
</table>

<h3 id="rdd--"><strong>{1,2,3}과 {3,4,5}를 가진 두 RDD에 대한 트랜스포메이션</strong></h3>

<table>
  <thead>
    <tr>
      <th>함수 이름</th>
      <th>용도</th>
      <th>예</th>
      <th>결과</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>union()</td>
      <td>두 RDD에 잇는 데이터들을 합한 RDD를 생성한다.</td>
      <td>rdd.union(other)</td>
      <td>{1,2,3,3,4,5}</td>
    </tr>
    <tr>
      <td>intersection()</td>
      <td>양쪽 RDD에 모두 있는 데이터들만을 가진 RDD를 반환한다.</td>
      <td>rdd.intersection(other)</td>
      <td>{3}</td>
    </tr>
    <tr>
      <td>subtract()</td>
      <td>한 RDD가 가진 데이터를 다른 쪽에서 삭제한다</td>
      <td>rdd.subtract(other)</td>
      <td>{1,2}</td>
    </tr>
    <tr>
      <td>cartesian()</td>
      <td>두 RDD의 카테시안 곱</td>
      <td>rdd.cartesian(other)</td>
      <td>{{1,3},{1,4},{1,5} … ,{3,5}}</td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<h1 id="rdd--1">기본 RDD 액션</h1>

<h3 id="rdd---"><strong>{1,2,3,3}을 갖고 있는 RDD에 대한 기본 액션</strong></h3>

<table>
  <thead>
    <tr>
      <th>함수 이름</th>
      <th>용도</th>
      <th>예</th>
      <th>결과</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>collect()</td>
      <td>RDD의 모든 데이터요소 리턴</td>
      <td>rdd.collect()</td>
      <td>{1,2,3,3}</td>
    </tr>
    <tr>
      <td>count()</td>
      <td>RDD의 요소 개수 리턴</td>
      <td>rdd.count()</td>
      <td>4</td>
    </tr>
    <tr>
      <td>countByValue()</td>
      <td>RDD에 있는 각 값의 개수 리턴</td>
      <td>rdd.countByValue()</td>
      <td>{{1,1},{2,1},{3,2}}</td>
    </tr>
    <tr>
      <td>take(num)</td>
      <td>RDD의 값들 중 num개 리턴</td>
      <td>rdd.take(2)</td>
      <td>{1,2}</td>
    </tr>
    <tr>
      <td>top(num)</td>
      <td>RDD의 값들 중 상위 num개 리턴</td>
      <td>rdd.top(2)</td>
      <td>{3,3}</td>
    </tr>
    <tr>
      <td>takeOrdered(num(ordering)</td>
      <td>제공된 ordering 기준으로 num개 값 리턴</td>
      <td>rdd.takeOrdered(2)(myOrdering)</td>
      <td>{3,3}</td>
    </tr>
    <tr>
      <td>takeSample(withReplacement, num, [seed])</td>
      <td>무작위 값을 리턴</td>
      <td>rdd.takeSample(false,1)</td>
      <td>생략</td>
    </tr>
    <tr>
      <td>reduce(func)</td>
      <td>RDD의 값들을 병렬로 병합 연산한다.</td>
      <td>rdd.reduce((x,y) -&gt; x+y)</td>
      <td>9</td>
    </tr>
    <tr>
      <td>fold(zero)(func)</td>
      <td>reduce()와 동일하나 제로 밸류를 넣어준다.</td>
      <td>rdd.fold(0)(x,y) -&gt; x+y</td>
      <td>9</td>
    </tr>
    <tr>
      <td>aggregate(zeroValue)(seqOP, combOp)</td>
      <td>reduce()와 유사하나 다른 타입을 리턴한다.</td>
      <td>rdd.aggregate((0,0))((x,y) -&gt; (x._1 + y, x._2 +1), (x,y) -&gt; (x._1 + y._1, x._2 + y._2))</td>
      <td>{9,4}</td>
    </tr>
    <tr>
      <td>foreach(func)</td>
      <td>RDD의 각값에 func을 적용한다.</td>
      <td>rdd.foreach(func)</td>
      <td>없음</td>
    </tr>
  </tbody>
</table>


                </div>
                <div class="read-all">
                    <a  href="/2017/02/26/basicrdd/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
        </ul>



        <!-- Pagination links -->
        <div class="pagination">
          
            <span class="previous disable"><i class="fa fa-angle-double-left"></i></span>
            <span class="previous disable"><i class="fa fa-angle-left"></i></span>
          
          <span class="page_number ">1/10</span>
          
            <a href="/page2" class="next"><i class="fa fa-angle-right"></i></a>
            <a href="/page10" class="next"><i class="fa fa-angle-double-right"></i></a>
          
        </div>
    </div>
    <!-- <button class="anchor"><i class="fa fa-anchor"></i></button> -->
    <div class="right">
        <div class="wrap">
            <!-- Content -->
            <div class="side ">
                <div>
                    <i class="fa fa-th-list"></i>
                    Categories
                </div>
                <ul class="content-ul" cate>
                    
                    <li>
                        <a href="/category/#js" class="categories-list-item" cate="js">
                            <span class="name">
                                js
                            </span>
                            <span class="badge">8</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#web" class="categories-list-item" cate="web">
                            <span class="name">
                                web
                            </span>
                            <span class="badge">15</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#python" class="categories-list-item" cate="python">
                            <span class="name">
                                python
                            </span>
                            <span class="badge">2</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Spring" class="categories-list-item" cate="Spring">
                            <span class="name">
                                Spring
                            </span>
                            <span class="badge">4</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Hadoop" class="categories-list-item" cate="Hadoop">
                            <span class="name">
                                Hadoop
                            </span>
                            <span class="badge">2</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Java" class="categories-list-item" cate="Java">
                            <span class="name">
                                Java
                            </span>
                            <span class="badge">6</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Etc" class="categories-list-item" cate="Etc">
                            <span class="name">
                                Etc
                            </span>
                            <span class="badge">7</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Unix/Linux" class="categories-list-item" cate="Unix/Linux">
                            <span class="name">
                                Unix/Linux
                            </span>
                            <span class="badge">2</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Swift" class="categories-list-item" cate="Swift">
                            <span class="name">
                                Swift
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#MYSQL" class="categories-list-item" cate="MYSQL">
                            <span class="name">
                                MYSQL
                            </span>
                            <span class="badge">3</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#BigData" class="categories-list-item" cate="BigData">
                            <span class="name">
                                BigData
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#ElasticSearch" class="categories-list-item" cate="ElasticSearch">
                            <span class="name">
                                ElasticSearch
                            </span>
                            <span class="badge">2</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Spark" class="categories-list-item" cate="Spark">
                            <span class="name">
                                Spark
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Cassandra" class="categories-list-item" cate="Cassandra">
                            <span class="name">
                                Cassandra
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                </ul>
            </div>
            <div class="side">
                <div>
                    <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                    Recent Posts
                </div>
                <ul class="content-ul" recent>
                    
                        <li><a href="/2017/04/08/garbagecollectionpauses/">Garbage collection pauses</a></li>
                    
                        <li><a href="/2017/04/02/runtojarbackground/">jar 백그라운드로 실행하기</a></li>
                    
                        <li><a href="/2017/03/27/mavenbuildplugin/">Maven Build Plugin & 옵션</a></li>
                    
                        <li><a href="/2017/03/26/properties/">properties 설정 및 사용</a></li>
                    
                        <li><a href="/2017/03/01/stringbuildervsstringbuffer/">StringBuilder vs StringBuffer</a></li>
                    
                        <li><a href="/2017/02/26/basicrdd/">기본 RDD연산들(트랜스포메이션, 액션)</a></li>
                    
                        <li><a href="/2017/02/19/logstash/">Logstash 기초</a></li>
                    
                        <li><a href="/2017/02/18/elasticsearchbasic/">ElasticSearch 기초</a></li>
                    
                        <li><a href="/2017/02/13/rdmsvsnosql/">RDBMS vs NOSQL</a></li>
                    
                        <li><a href="/2017/01/09/mysqlprocedureinsert/">Stored Procedure으로 Insert</a></li>
                    
                </ul>
            </div>

<!--
            <div class="side">
                <div>
                    <i class="fa fa-tags"></i>
                    Tags
                </div>
                <div class="tags-cloud">
                    
                    
                    
                    

                    

                    
                </div>
            </div> -->
        </div>
    </div>
</div>


    <footer class="site-footer">


    <div class="wrapper">

        <p class="description">
            
        </p>
        <p class="contact">
            Contact me at: 
            <a href="https://github.com/joswlv" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a>  
            <a href="mailto:wh7923@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>     
            <a href="https://www.facebook.com/wsj7923" title="Facebook"><i class="fa fa-facebook-official" aria-hidden="true"></i></a>    
        </p>
        <p>
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>
        </p>
    </div>
</footer>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <div class="back-to-top">
    <a href="#top" class="scroll">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/scroll.min.js " charset="utf-8"></script>
  </body>

</html>
