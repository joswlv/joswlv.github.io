<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="Jo Blog">
    <meta property="og:description" content="Jo Seungwan Blog!~~!">
    <meta property="og:image" content="https://raw.githubusercontent.com/joswlv/joswlv.github.io/master/bg.jpg">
    <meta property="og:url" content="https://joswlv.github.io">

    <title>Joswlv</title>
    <meta name="description" content="">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href="/css/fontawesome/css/font-awesome.min.css ">
    <link rel="stylesheet" href="/css/main.css ">
    <link rel="canonical" href="http://joswlv.github.io/">
    <link rel="alternate" type="application/rss+xml" title="Joswlv" href="http://joswlv.github.io/feed.xml ">



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83868242-1', 'auto');
  ga('send', 'pageview');

</script>

</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">Joswlv</a>
        <small></small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a class="active" href="/">
                        
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>

                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" index>
    <div class="left">
        <!-- <h1>Welcome to SW's Blog!</h1>
        <small></small> -->
        <hr>
        <ul>
            
              <li>
                <h2>
                  <a class="post-link" href="/2017/10/24/sparkstreamingandkafka/">SparStreaming & kafka(Exactly-once)</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-10-24
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Spark" title="Category: Spark" rel="category">Spark</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                </div>
                <div class="excerpt">
                    <h1 id="sparkstreaming--kafka-">SparkStreaming &amp; Kafka 연동</h1>

<p>팀에서 실시간 리포트입력 소스를 kafka로 변경하는 작업을 했다. 이 글은 작업을 하는 동안 배운 것을 정리한다.</p>

<p>먼저 스트림 처리를 신뢰도에 따라 다음과 같이 세가지로 구분법을 알아보자!</p>

<ul>
  <li>At-most-once(최대 한 번): 데이터 유실이 있을 수 있어, 추천하지 않는 방식</li>
  <li>At-least-once(적어도 한 번): 데이터 유실은 없으나 재전송으로 인해 중복이 생길 수 있음. 대부분의 경우 충분한 방식</li>
  <li>Exactly-once(딱 한 번): 데이터가 오직 한 번만 처리되어 유실도 중복도 없음. 모든 상황에 대해 완벽히 보장하기 어렵지만 가장 바라는 방식</li>
</ul>

<p>회사에서 사용하고 있는 Spark 버전이 1.5이므로 1.5까지 SparkStreaming의 변천사를 보자.</p>

<ul>
  <li>v1.0 - Graceful shutdow기능
    <ul>
      <li>Driver로 부터 중단 신호를 받으면 Receiver는 더 이상 데이터를 가져오지 않고, Driver는  Receiver가 이미 받아온 데이터가 처리될 때까지 기다렸다가 중지한다.</li>
    </ul>
  </li>
  <li>v1.2 - 데이터 유실방지를 위한 WAL(Write Ahead Logs)</li>
  <li>v1.3 - Kafka Direct API
    <ul>
      <li>WAL를 사용한 처리방식은 성능저하를 발생시킴</li>
      <li>Kafka Direct API는 receiver를 사용하지 않고 executor에서 직접 Kafka의 Simple Consumer API를 사용하여 offset 범위를 지정한 만큼 데이터를 받아서 처리한다.
스트림 처리를 위한 KafkaUtils.createDirectStream() 외에 KafkaUtils.createRDD()를 제공해 Kafka 데이터를 배치 처리할 수 있는 기능도 추가됨</li>
      <li>Kafka Direct API로 exactly-once를 보장하게 되어 비로소 유실 없는 스트림 처리에 Spark Streaming을 사용할 수 있게 됨.</li>
    </ul>
  </li>
  <li>v1.4 - UI향상 <a href="https://databricks.com/blog/2015/07/08/new-visualizations-for-understanding-apache-spark-streaming-applications.html">DataBricks Blog</a>
    <ul>
      <li>Processing Time, Scheduling Delay를 확인 할 수 있어 배치 시간을 설정하는데 도움이 됨.</li>
    </ul>
  </li>
  <li>v1.5 - Back Pressure
    <ul>
      <li>Back Pressure은 시스템이 불안정 상태일 경우에 데이터를 받아오는 양을 조절해 주는 기능이다.</li>
      <li>갑자기 많은 양의 데이터가 몰려 들어오거나 분산환경에서 일시적으로 처리지연이 발생할 경우 시스템이 동적으로 Input Rate을 조절해 다시 안정을 찾도록 한다.</li>
    </ul>
  </li>
</ul>

<p>앞선 버전별 설명에서 보면 SparkStreming에서 Kafka를 연동에 두가지 방법이 존재한다.</p>

<h3 id="kafka-api">1) Kafka API</h3>

<p>이방식은 Receiver를 통해 kafka로 부터 Data를 전달 받는다. 그리고 데이터 유실을 방지하기 위해 WAL를 사용해 kafka로 부터 받은 데이터를 저장을 하면서 처리한다. Receiver를 사용하는 경우, 처음 receiver를 시작할 때 만들어진 Kafka 연결을 계속 사용하기 때문에, 매 배치마다 연결 지연이 발생하지 않음.</p>

<p>WAL을 사용한 receiver 방식은 Kafka로부터 받은 데이터가 WAL에 먼저 저장되는데, Zookeeper에 Kafka의 offset을 갱신하기 전에 시스템이 실패할 경우, Spark Streaming은 데이터를 받았다고 인식하지만 Kafka는 데이터를 전달하지 않았다고 인식하는 불일치가 발생합니다. 이후 시스템이 복구되면 Spark Streaming은 WAL에 저장된 데이터를 읽어 복구 처리를 하고 receiver를 동작시킵니다. Receiver는 Kafka로부터 다음 데이터를 받아오려고 하는데, Kafka는 Zookeeper에 저장된 offset 정보를 보고, 이전 데이터를 전달하지 않았다고 보게 되므로, 보낼 필요가 없는 데이터를 다시 전송한다. 결국 복구 처리를 두 번하게 된다.(At-least-once)</p>

<p>그리고 다음과 같이 DStream을 생성한다.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">JavaPairReceiverInputDStream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">kafkaStream</span> <span class="o">=</span> 
     <span class="n">KafkaUtils</span><span class="o">.</span><span class="na">createStream</span><span class="o">(</span><span class="n">streamingContext</span><span class="o">,</span>
     <span class="o">[</span><span class="n">ZK</span> <span class="n">quorum</span><span class="o">],</span> <span class="o">[</span><span class="n">consumer</span> <span class="n">group</span> <span class="n">id</span><span class="o">],</span> <span class="o">[</span><span class="n">per</span><span class="o">-</span><span class="n">topic</span> <span class="n">number</span> <span class="n">of</span> <span class="n">Kafka</span> <span class="n">partitions</span> <span class="n">to</span> <span class="n">consume</span><span class="o">]);</span>
</code></pre>
</div>

<h3 id="kafka-dricet-api">2) Kafka Dricet API</h3>

<p>가장 큰 특징은 Receiver를 사용하지 않는다. 그래서 다음과 같은 특성이 있다.</p>

<ul>
  <li>매 배치마다 새로 할당받은 executor에서 kafka에 연결해서 데이터를 가져와 약간의 지연이 발생함 하지만 Exactly-once를 보장한다.</li>
  <li>Kafka의 각 파티션은 하나의 executor에서 직접 받아오고, 하나의 RDD 파티션이 생성된다. 즉, Kafka의 파티션 수만큼 병렬화하여 데이터를 가져온다. kafka파티션수로 병렬수준을 쉽게 설정할 수 있다.</li>
  <li>Zookeeper에 offset 정보를 갱신하지 않는다. offset정보를 직접 Handling해야한다.</li>
</ul>

<p>Kafka Direct API 방식에서 checkpoint를 사용하면 driver는 장애 복구를 위해 어플리케이션의 메타 데이터를 HDFS나 S3처럼 신뢰성 있는 저장소에 저장한다. 메타 데이터에는 어플리케이션 설정 정보와 스케쥴러에 등록되었지만(queued) 아직 완료되지 않은 배치 작업에 대한 정보를 저장한다. 배치 작업 정보에는 offset 정보도 포함되어 있어 driver 장애로 중단된 스트림 처리를 복구할 때 저장된 메타 데이터를 읽어 불필요한 재전송 없이 장애가 발생했던 부분부터 처리할 수 있습니다.</p>

<p>여기서 offset를 관리하는 방법은 다음과 같다.</p>

<ol>
  <li>kafka에서 offset정보를 읽어온다.</li>
  <li>shuffle이 발생하기전에 offset을 Hbase, HDFS, Kafka, Zookeeper등에 저장한다.</li>
  <li>비정상적으로 종료되었다가 재시작되면 저장되어 있던 offset부터 읽어 다시 처리한다.</li>
</ol>

<p>쉽게 offset을 저장하는 방법은 Spark의 checkpoint에 저장하는 방법있다.</p>

<ul>
  <li>Kafka의 offset 정보를 직접 접근할 필요가 없다. Spark Streaming이 알아서 checkpoint의 메타 데이터에 offset 정보를 저장한다</li>
  <li>Spark Streaming을 다시 시작하더라도 자동으로 checkpoint에 저장된 offset 정보를 읽어서 이어서 처리할 수 있다.</li>
</ul>

<p>하지만 여기에 다음과 같은 문제가 있다.</p>

<ul>
  <li>Spark Streaming이 알아서 저장하기 때문에 최종 결과를 저장했음에도 불구하고 offset을 checkpoint에 저장하지 못하고 장애가 발생하는 경우가 발생할 수 있다.
    <ul>
      <li>결과 저장 단계에서 트랜잭션을 지원하면 두 번의 트랜잭션이 발생할 수 있다. 따라서 결과 저장이 멱등해야 한다.</li>
    </ul>
  </li>
  <li>checkpoint에 저장된 메타 데이터를 읽을 수 없으면, 재시작을 하더라도 마지막 처리된 이후부터 처리할 수 없다.
    <ul>
      <li>checkpoint 정보는 직렬화(serialized)된 객체를 저장하는데, 역직렬화(deserialize)할 때 클래스가 바뀌면 에러가 발생하며 실패한다.</li>
      <li>어플리케이션이 시스템 장애로 재시작하면 코드 변화가 없기 때문에 역직렬화 문제가 발생하지 않는다.</li>
      <li>스트림 처리를 재시작하는 경우는 대부분 어플리케이션이 데이터를 잘못 처리해서 죽어버리거나 잠재적인 오류를 수정하여 어플리케이션을 재배포하는 경우이기 때문에, 어플리케이션 코드가 동일한 경우가 별로 없다. 따라서 checkpoint를 믿고 사용하기에는 불안정한 요소가 많다.</li>
      <li>window 연산은 checkpoint를 사용할 수 밖에 없는데, 어플리케이션 코드 변경에 취약하다는 점을 알고 사용해야 한다.</li>
    </ul>
  </li>
</ul>

<p>회사에서는 관리의 편의상 Zookeeper에 offset을 저장하는 방법으로 실시간리포트를 구현하였다.</p>

<p>소스는 다음과 같다.</p>

<script src="https://gist.github.com/joswlv/f66e91bb2649f7035b4f54a4d9d0368a.js"></script>

<h3 id="sparkstreaming--">3) SparkStreaming에서 주의 할점</h3>

<h4 id="spark-executor--">1. Spark Executor 메모리 설정</h4>

<ul>
  <li>데이터 원천으로부터 읽은 데이터를 executor의 메모리에 담아두어야 하기 때문에, executor의 메모리 설정은 하나의 배치 단위에서 받아올 수 있는 최대 데이터 크기보다 크게 설정해야 한다.</li>
  <li>Window 연산을 할 경우, window 크기만큼 여러 배치의 데이터를 모두 메모리에 올릴 수 있어야 합니다.</li>
</ul>

<h4 id="max-rate-">2. 최대 처리율(max rate) 설정</h4>

<ul>
  <li>Kafka Direct API를 사용할 때 최대 처리율을 지정하는 옵션은 <code class="highlighter-rouge">spark.streaming.kafka.maxRatePerPartition</code> 이다.
이 설정은 파티션당 초당 처리량이라는 점을 주의 해야한다. 배치 간격이 10초이고 최대 처리율이 1000이고, 파티션 수가 4개라면 데이터는 최대 4 * 1000 * 10 = 4000만큼 받아옵니다.</li>
  <li>최대 처리율을 설정하지 않으면 Spark Streaming을 중단했다가 재시작할 때, 그동안 처리하지 않고 쌓인 데이터를 한꺼번에 받아와서 처리하려고 한다.</li>
  <li>배치 간격 동안 충분히 처리할 수 있는 데이터 양이라면 문제가 없지만, 중단 시간이 길어질수록 데이터 양은 많아지기 때문에 배치 간격 내에 처리하기 어려워지고 지연시간이 증가하거나 메모리 부족이 발생한다.</li>
  <li>중단과 재시작에서 설명하였듯이 재시작시 초기 배치는 시간이 더 걸리기 때문에, 안심하고 재시작을 자유롭게 하려면 최대 처리율을 설정하는 것이 좋다.</li>
  <li>최대 처리율은 여러 번의 테스트를 통해 배치 간격 동안 처리할 수 있는 최대로 지정합니다. 단, 재시작 초기의 처리는 평소보다 느리니 초기 결과를 사용하지 않는다.</li>
  <li>최대 처리율을 낮게 설정하면, 오랫동안 중단된 후 재시작하는 경우에 중단된 시간만큼의 데이터를 따라잡는데 오래 걸릴 수 있다.</li>
  <li>최대 처리율을 높게 설정했음에도 불구하고 따라잡는 시간이 오래 걸릴 경우, KafkaUtils.createRDD()을 사용해 배치 처리를 할 수 있다. 단, offsetsRange를 지정해야 하므로, 마지막 처리 offset과 현재 Kafka에 들어온 마지막 offset을 알아야 한다.</li>
  <li>여러 개의 Kafka topic을 동시에 처리하면, 최대 처리율은 당연히 데이터 입수율이 가장 높은 topic을 기준으로 설정한다.</li>
</ul>

<h4 id="backpressure-">3. BackPressure 설정</h4>

<ul>
  <li>BackPressure 설정은 <code class="highlighter-rouge">spark.streaming.backpressure.enabled</code>를 true로 설정합니다.</li>
  <li>최대 처리율을 설정하더라도 역 압력을 설정하면 분산 환경과 입력 데이터의 변화에 대응하기 좋습니다.</li>
  <li>분산 환경의 특성상 처리 시간이 배치 간격보다 커지면, 다음 배치의 일정 지연이 생기고 불안정(unstable) 상태가 됩니다.
불안정 상태가 되면 역 압력에 의해 입력율(Input Rate)을 줄임으로써 처리 시간을 줄이고, 배치 간격을 기다리지 않고 연속해서 다음 배치를 실행해 일정 지연을 0으로 만든다.</li>
  <li>일정 지연이 0이 되면 입력율을 조금씩 높여서 버퍼링 되는 데이터를 줄인다.</li>
  <li>입력율은 안정 상태가 지속되는 한 최대 처리율까지 올라갈 수 있다.</li>
  <li>버퍼링 되는 데이터를 모두 소진하면 입력율은 다시 평소처럼 낮아진다.</li>
  <li>BackPressure 설정을 하면 처리 시간이 배치 간격보다 클 때마다 입력율이 낮아졌다 올라갔다 다시 정상으로 돌아오는 과정이 반복됩니다.</li>
</ul>

<h4 id="section">4. 번외</h4>

<p>중단된 시간이 너무 길어지면, Kafka에서 버퍼링하며 저장할 수 있는 데이터 크기를 넘어설 수 있다. Kafka가 보관하고 있어서 언제든지 전송할 수 있는 offset을 지나치면, 스트림 처리에서 offset을 잘 저장하고 있더라도 재시작할 때 <code class="highlighter-rouge">OffsetOutOfRangeException</code>이 발생한다. 당연히 유실 없는 스트림 처리는 불가능한 상황이 된다. 따라서 중단될 수 있는 최대 예상 시간 동안 데이터를 충분히 버퍼링 할 수 있도록 Kafka를 설정해 둬야 한다.</p>

<p>회사에서는 kafka에 저장된 시간이 20분이다. 20분넘게 장애가 발생하고 실시간 리포트 Job을 재시작하면 <code class="highlighter-rouge">OffsetOutOfRangeException</code>이 발생한다. offset이 가리키고 있는 데이터가 삭제되어 존재하지 않기 때문이다. 이때 예외처리는 offset을 최근으로 재설정하는 방법을 취했다.</p>

<h3 id="refrence">Refrence</h3>

<ul>
  <li><a href="http://readme.skplanet.com/?p=12465">SK플래닛 기술 블로그</a></li>
  <li><a href="https://blog.cloudera.com/blog/2017/06/offset-management-for-apache-kafka-with-apache-spark-streaming/">Offset Management For Apache Kafka With Apache Spark Streaming</a></li>
  <li><a href="http://aseigneurin.github.io/2016/05/07/spark-kafka-achieving-zero-data-loss.html">Spark &amp; Kafka - Achieving zero data-loss</a></li>
</ul>

                </div>
                <div class="read-all">
                    <a  href="/2017/10/24/sparkstreamingandkafka/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2017/09/27/spark_misapprehension/">Spark에 대한 오해</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-09-27
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Spark" title="Category: Spark" rel="category">Spark</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                </div>
                <div class="excerpt">
                    <h1 id="spark--">Spark에 대한 오해</h1>

<h4 id="section">대표적인 오해</h4>

<ul>
  <li>Spark는 in-memory technology이다?</li>
  <li>Spark는 hadoop MR보다 100배 빠르다?</li>
  <li>Spark는 이분야에서 데이터 프로세싱을 완전히 새로운 접근을 소개했다?</li>
</ul>

<h3 id="spark-in-memory-technology-">1. Spark는 in-memory technology가 아니다.</h3>

<p>in-memory technology라고 하는 것은, 데이터를 처리하는 동안 RAM에 persist 하는것 이라고 한다.</p>

<p>하지만 Spark의 겨우 모든 겨우 데이터를 persist하는 것이 아니라 cache를 한다.</p>

<ul>
  <li>요즘 OS단에서 데이터를 메모리에 로딩하지 않고 바로 disk에서 바로 프로세싱이 가능하게 하는 API는 없다!! 그러므로 데이터 프로세싱을 한다는 것은 굳이 언급하지 않아도 in-memory processing이다.</li>
  <li>Spark는 LRU eviction rules를 사용한다. 데이터가 메모리에 충분히 들어갈 경우에는 in-memory technology가 맞지만 그렇지 않을 경우에는 LRU룰을 따른다. 요즘 대부분의 RDBMS 또한 LRU룰을 이용하지만 in-memory technology라고 부르지 않는다. 또한 Linux IO 역시 모든 IO operations이 OS IO cashe(이 역시 LRU캐쉬)를 통과하고 있다.</li>
  <li>Spark는 모든 transforamtion연산을 in-memory에서 하지 않는다. shuffle시에 데이터를 disk에 쓰도록 설계되어 있다. 가령 SparkSQL query에서 group by를 하거나, RDD를 PairRDD로 변경하거나, aggregationbyKey를 하면, Spark에게 key의 hash된 값을 기반으로 partition들 사이에서 데이터를 distribute하게 된다. shuffle은 2가지 phase로 이루어지는데, 1) map, 2) reduce이다. map은 단지 key의 hash값을 계산하고, N개의 파일로 local filesystem상에 output을 만든다. reduce는 map의 데이터를 가져와 merge를 해서 새로운 partition을 만든다. 만약 M개의 partitions을 가지고, N개의 pair RDD쌍으로 transform을 한다면, M*N개의 파일을 local filesystem에 생성한다. 파일을 줄이기 위한 최적화가 있긴하다. 하지만 그런 앞단의 작업이 있음에도 불구하고, 결국에 HDD에 데이터를 놓기 위해서는 shuffle이 필요하다는 사실만은 변함이 없다.</li>
</ul>

<p><strong>따라서</strong> Spark는 in-memory technology가 아니다.</p>

<ul>
  <li>spark는 효과적으로 in-memory LRU cache를 할 수 잇게 해주는 기술이다.</li>
  <li>Spark는 built-in persistence functionality를 가지지 않았다.</li>
  <li>Spark는 shuffle과정동안에 모든 dataset을 local filesystem에 놓는다.</li>
</ul>

<h3 id="hadoop-mr-100-">2. Hadoop MR보다 100배 빠르다?</h3>

<p><img src="http://joswlv.github.io/images/SparkBenchmark.png" alt="" /></p>

<p>Spark 메인페이지에서 볼 수 있는 위와 같은 성능 측정 결과는 Logistic regreesion에 대한 것이다. 머신러닝에 대한 일을 처리할 경우 테스트하여 성능 결과를 측정해 놓은 것이다.</p>

<p>보통 머신러닝에서는 동일한 dataset에 대해서 repeatedly iteration을 많이 하곤한다. 이 경우 Spark의 LRU 캐쉬를 이용한 in-memory cache가 빛이나는 경우이다.!!</p>

<p>반복적으로 같은 dataset에 여러번 접근할 경우에 처음에만 읽고 원할때 마다 데이터에 접근 할 수 있는데 결국 memory에 있는 것을 읽기만 하면 된다. 이 경우는 BestCase이다.</p>

<p>그러나 불행하게도, Hadoop상에서 위와 같은 반복작업이 실행될 경우에는 HDFS cache 능력을 잘 활용하지 못하는거 같다. (<a href="http://hadoop.apache.org/docs/r2.4.1/hadoop-project-dist/hadoop-hdfs/CentralizedCacheManagement.html">Haddop-cache</a>)</p>

<p>대략적으로 3x ~ 4x배 정도 Spark가 빠르다고 여겨지는데,</p>

<ul>
  <li>Spark는 startup time이 더 빠르다. (Spark는 thread를 fork하고, MR은 JVM을 새로 띄운다.)</li>
  <li>Spark는 shuffle이 더 빠르다. Spark는 shuffles동안에 한번만 HDD에 데이터를 쓰는데, MR은 이것을 2배 한다.</li>
  <li>Spark는 workflows가 더 빠르다. MR의 workflow는 MR Jobs의 하나의 시리즈이고, 각각 단계에서의 data를 HDFS에 저장을 한다. 반면에 Spark는 DAGs와 pipelining을 지원하는데, 중간 데이터 없이 복잡한 workfows를 허용하게 해준다. (물론 사용자가 shuffle을 필요로 하지 않을 경우에..)</li>
  <li>Caching이 더 낫다. 이것은 약간 논쟁이 되고 있는데, 지금은 HDFS또한 cache을 할 수 있기 때문이다. 그러나 대체로 Spark의 cache가 매우 좋다. 특히 SparkSQL에 더욱 그렇다. Spark SQL은 최적화되어지니 column-oriented 형태로 데이터를 캐쉬한다.</li>
</ul>

<p>결론적으로 짧은 실행의 job의 경우에는 100x배까지 빠를수는 있어도 보통의 실제 경우의 작업에서는 Hadoop의 성능보다 최대 2.5 ~3배를 넘지 않을 것이다.</p>

<h3 id="spark-------">3. Spark는 이분야에서 데이터 프로세싱을 완전히 새로운 접근을 소개했다?</h3>

<p>Spark에 의해서 혁명적으로 새로운것이 소개된게 없다. 효과적으로 LRU cache를 이용하고 data processing pipelining을 이용했지만 비단 Spark만 그랫던것은 아니다.</p>

<p>만약에 이 문제에 대해서 마음을 좀 열어둔다면, 너는 MPP databases에 의해서 소개되어진( query execution pipelinig, no itermediate data materializaion, LRU cache) 과 거의 같은 컨셉이라는것을 알아차릴 수 있다.</p>

<p>물론 Spark는 이것을 open source로 해서 무료로 사용할 수 있게 제공하고 있다. ( 대부분의 회사들이 MPP database가 좋다고 해도, 엔터프라이즈 MPP 을 돈 주고 쓰고 있지 않는다.. )</p>


                </div>
                <div class="read-all">
                    <a  href="/2017/09/27/spark_misapprehension/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2017/08/06/howtousesbt/">sbt 기본 사용법</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-08-06
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Scala" title="Category: Scala" rel="category">Scala</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                </div>
                <div class="excerpt">
                    <h1 id="sbt--">SBT 기본 사용법</h1>

<h3 id="sbt------">1. SBT 프로젝트 디렉토리 구조 및 기본적인 명령어</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>|-src/
|--main/
|----resources/
|       &lt;files to include in main jar here&gt;
|----scala/
|       &lt;main Scala sources&gt;
|----java/
|       &lt;main Java sources&gt;
|--test/
|----resources
|       &lt;files to include in test jar here&gt;
|----scala/
|       &lt;test Scala sources&gt;
|----java/
       &lt;test Java sources&gt;
       
빌드 definition 파일 - 베이스 디렉토리에 있는 build.sbt 파일 
빌드 support 파일 - 베이스 디렉토리 하위 project라는 디렉토리에 포함한 파일들을 의미한다. 
빌드 target 디렉토리 - 기본으로 베이스 디렉토리 하위의 target
       
</code></pre>
</div>

<p>maven과 유사하다.</p>

<p>간단한 테스크를 실행하면 아래와 같다.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>➜  scala-Learning-spark sbt clean package
<span class="o">[</span>info] Loading global plugins from /Users/nhnent/.sbt/0.13/plugins
<span class="o">[</span>info] Loading project definition from /Users/nhnent/dev/scala-Learning-spark/project
<span class="o">[</span>info] Set current project to scala-Learning-spark <span class="o">(</span><span class="k">in </span>build file:/Users/nhnent/dev/scala-Learning-spark/<span class="o">)</span>
<span class="o">[</span>success] Total <span class="nb">time</span>: 0 s, completed 2017. 8. 7 오후 8:14:27
<span class="o">[</span>info] Updating <span class="o">{</span>file:/Users/nhnent/dev/scala-Learning-spark/<span class="o">}</span>scala-learning-spark...
<span class="o">[</span>info] Resolving jline#jline;2.12.1 ...
<span class="o">[</span>info] Done updating.
<span class="o">[</span>info] Packaging /Users/nhnent/dev/scala-Learning-spark/target/scala-2.11/scala-learning-spark_2.11-1.0.jar ...
<span class="o">[</span>info] Done packaging.
<span class="o">[</span>success] Total <span class="nb">time</span>: 1 s, completed 2017. 8. 7 오후 8:14:28
</code></pre>
</div>

<p><strong>기본적인  명령어</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>clean - 타겟 디렉토리에 생성된 모든 파일을 삭제한다.
compile - 메인 리소스에 있는 모든 소스를 컴파일 한다.
test - 컴파일을 하고 모든 테스트케이스를 수행한다.
package - src/main 하위의 자바와 스칼라의 컴파일된 클래스와 리소스를 패키징한다./java.
reload  - 빌드 설정을 리로드한다.
</code></pre>
</div>

<p>기본적인 사용법은 maven과 매우 유사한 것을 알 수 있다.</p>

<p>빌드 버전은 <code class="highlighter-rouge">project/build.properties</code>에서 설정할 수 있다.</p>

<h3 id="dependencies-">2. Dependencies 추가하기</h3>

<p>maven의 <code class="highlighter-rouge">pom.xml</code>파일처럼 sbt에서는 build.sbt에 명세한다.</p>

<p>intellij에서 sbt프로젝트를 생성하면 다음과 같이 적혀있다.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>name := "scala-Learning-spark"

version := "1.0"

scalaVersion := "2.11.8"
</code></pre>
</div>

<p>규칙은 다음과 같다.</p>

<ul>
  <li>좌측부분은 키이다.</li>
  <li>오퍼레이터 는 <code class="highlighter-rouge">:=</code>이다.</li>
  <li>우측부분은 바디라고 불린다.</li>
</ul>

<p>maven처럼 dependencies를 설정할려면 다음과 같이 추가 해주면 된다.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>libraryDependencies ++= Seq(
  groupID % artifactID % revision,
  groupID % otherID % otherRevision
)
</code></pre>
</div>

<p>예를 들면 다음과 같다.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>libraryDependencies ++= Seq(
  "org.apache.spark" %% "spark-core" % "1.6.0" % "provided",
  "org.apache.spark" %% "spark-sql" % "1.6.0" % "provided",
  "org.apache.spark" %% "spark-hive" % "1.6.0" % "provided"
)
</code></pre>
</div>

<p>기본적으로 Dependency 소스저장소는 <code class="highlighter-rouge">Maven2 repository</code>를 사용한다. 하지만 사내망안에 있는 reopsitory가 필요할 때가 있다. 이럴 때 maven에서는 <code class="highlighter-rouge">&lt;repositories&gt;</code>태그를 추가해서 해결 했지만 sbt는 다음과 같이 한다.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>resolvers += name at location

#ex&gt; resolvers += "Sonatype OSS Snapshots" at "https://oss.sonatype.org/content/repositories/snapshots"
</code></pre>
</div>

<h3 id="assembly-plugin">3. assembly plugin사용법</h3>

<p>maven에서 dependency libraries를 함께 packaging을 할 수 있었다. sbt에서도 똑같이 할 수 있는데 방법은 다음과 같다.</p>

<p>build.sbt에 다음 내용을 추가한면된다.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#jar이름 설정
assemblyJarName in assembly :=  artifact.value.name + "-" + version.value + "." + artifact.value.extension

###예시###
assemblyMergeStrategy in assembly := {
  case PathList("javax", "servlet", xs @ _*)         =&gt; MergeStrategy.first
  case PathList(ps @ _*) if ps.last endsWith ".html" =&gt; MergeStrategy.first
  case "application.conf"                            =&gt; MergeStrategy.concat
  case "unwanted.txt"                                =&gt; MergeStrategy.discard
  case x =&gt;
    val oldStrategy = (assemblyMergeStrategy in assembly).value
    oldStrategy(x)
}
###예시 end###

assemblyMergeStrategy in assembly := {
  case PathList("com","payco",xs @ _*) =&gt; MergeStrategy.last
  case _ =&gt; MergeStrategy.discard
}
</code></pre>
</div>

<p>이렇게 설정한뒤에 다음 명령어를 사용하면 원하는 데로 packaging을 할 수 있다.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sbt clean assembly
</code></pre>
</div>

<h3 id="section">4. 기본적인 오퍼레이션 설명</h3>

<ul>
  <li>
    <p><strong><code class="highlighter-rouge">:=</code></strong>
you can assign a value to a setting and a computation to a task. For a setting, the value will be computed once at project load time. For a task, the computation will be re-run each time the task is executed.</p>
  </li>
  <li>
    <p><strong><code class="highlighter-rouge">+=</code></strong>
will append a single element to the sequence.</p>
  </li>
  <li>
    <p><strong><code class="highlighter-rouge">++=</code></strong>
will concatenate another sequence.</p>
  </li>
</ul>

<p>예를들어 기본적으로 컴파일 폴더는 src/main/scala가 되는데, Compile의 Seq[File] 값을 가지는 sourceDirectories라는 키를 통해 컴파일 단계에서 source라는 디렉토리를 컴파일에 포함시키고 싶다면 아래와 같이 하면된다.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">sourceDirectories</span> <span class="n">in</span> <span class="nc">Compile</span> <span class="o">+=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"source"</span><span class="o">)</span>
</code></pre>
</div>

<p>아니면  sbt 패키지에 포함되어 있는 file() 함수로 더 쉽게 할 수도 있다.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">sourceDirectories</span> <span class="n">in</span> <span class="nc">Compile</span> <span class="o">+=</span> <span class="n">file</span><span class="o">(</span><span class="s">"source"</span><span class="o">)</span>
</code></pre>
</div>

<p>(file() just creates a new File.)</p>

<p>++= 메소드를 사용하면 여러 디렉토리를 한번에 추가 하는 것도 가능하다.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">sourceDirectories</span> <span class="n">in</span> <span class="nc">Compile</span> <span class="o">++=</span> <span class="nc">Seq</span><span class="o">(</span><span class="n">file</span><span class="o">(</span><span class="s">"sources1"</span><span class="o">),</span> <span class="n">file</span><span class="o">(</span><span class="s">"sources2"</span><span class="o">))</span>
</code></pre>
</div>

<p>default source directory를 완전 수정하고 싶다면 <code class="highlighter-rouge">:=</code> 메소드를 사용하자.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">sourceDirectories</span> <span class="n">in</span> <span class="nc">Compile</span> <span class="o">:=</span> <span class="nc">Seq</span><span class="o">(</span><span class="n">file</span><span class="o">(</span><span class="s">"sources1"</span><span class="o">),</span> <span class="n">file</span><span class="o">(</span><span class="s">"sources2"</span><span class="o">)</span>
</code></pre>
</div>

                </div>
                <div class="read-all">
                    <a  href="/2017/08/06/howtousesbt/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2017/08/02/pythonTricks/">Python Tricks</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-08-02
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#python" title="Category: python" rel="category">python</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                </div>
                <div class="excerpt">
                    <h2 id="neat-python-tricks-beginners-should-know">9 Neat Python Tricks Beginners Should Know</h2>

<h3 id="trick-1">Trick #1</h3>

<h4 id="string-reversing">String Reversing</h4>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="s">"comdementor"</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="s">"Reverse is"</span><span class="p">,</span><span class="n">a</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">Reverse</span> <span class="ow">is</span> <span class="n">rotnemedoc</span>
</code></pre>
</div>

<h3 id="trick-2">Trick #2</h3>

<h4 id="transposing-a-matrix">Transposing a Matrix</h4>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">mat</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">mat</span><span class="p">)</span>
<span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">)]</span>
</code></pre>
</div>

<h3 id="trick-3">Trick #3</h3>

<h4 id="store-all-three-values-of-the-list-in-3-new-variables">Store all three values of the list in 3 new variables</h4>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">a</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">x</span>
<span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">y</span>
<span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">z</span>
<span class="mi">3</span>
</code></pre>
</div>

<h3 id="trick-4">Trick #4</h3>

<h4 id="create-a-single-from-all-the-elements-in-list-above">Create a single from all the elements in list above</h4>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">,</span> <span class="s">"c"</span><span class="p">,</span> <span class="s">"d"</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="s">" "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span>
</code></pre>
</div>

<h3 id="trick-5">Trick #5</h3>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">list1</span> <span class="o">=</span> <span class="p">[</span><span class="s">'a'</span><span class="p">,</span><span class="s">'b'</span><span class="p">,</span><span class="s">'c'</span><span class="p">,</span><span class="s">'d'</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">list2</span> <span class="o">=</span> <span class="p">[</span><span class="s">'p'</span><span class="p">,</span><span class="s">'q'</span><span class="p">,</span><span class="s">'r'</span><span class="p">,</span><span class="s">'s'</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">list1</span><span class="p">,</span><span class="n">list2</span><span class="p">):</span>
<span class="o">...</span> 	<span class="k">print</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
<span class="o">...</span>
<span class="n">a</span> <span class="n">p</span>
<span class="n">b</span> <span class="n">q</span>
<span class="n">c</span> <span class="n">r</span>
<span class="n">d</span> <span class="n">s</span>
</code></pre>
</div>

<h3 id="trick-6">Trick #6</h3>

<h4 id="swap-two-numbers-with-on-line-of-code">Swap two numbers with on line of code</h4>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="o">=</span><span class="mi">7</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="o">=</span><span class="mi">5</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
<span class="mi">5</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span>
<span class="mi">7</span>
</code></pre>
</div>

<h3 id="trick-7">Trick #7</h3>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="s">"code"</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="s">' '</span><span class="o">+</span><span class="s">"good"</span><span class="o">*</span><span class="mi">5</span>
<span class="n">codecodecodecode</span> <span class="n">goodgoodgoodgoodgood</span>
</code></pre>
</div>

<h3 id="trick-8">Trick #8</h3>

<h4 id="convert-it-to-a-single-list-without-using-any-loops">Convert it to a single list without using any loops.</h4>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">list1</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="mi">1</span> <span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="p">,</span> <span class="p">[</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">answer</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">list1</span> <span class="p">,</span> <span class="p">[</span> <span class="p">]</span> <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="n">answer</span>
<span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span>
</code></pre>
</div>
<h3 id="trick-9">Trick #9</h3>

<h4 id="taking-a-string-input">Taking a string input</h4>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">wantToInt</span> <span class="o">=</span> <span class="s">"1 2 3 4"</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">wantToInt</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</code></pre>
</div>

<h3 id="section">출처</h3>

<ul>
  <li><a href="https://www.codementor.io/sumit12dec/python-tricks-for-beginners-du107t193">https://www.codementor.io/sumit12dec/python-tricks-for-beginners-du107t193</a></li>
</ul>

                </div>
                <div class="read-all">
                    <a  href="/2017/08/02/pythonTricks/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2017/08/01/MySql-Setting/">MySQL 기본세팅법</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-08-01
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#MYSQL" title="Category: MYSQL" rel="category">MYSQL</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                </div>
                <div class="excerpt">
                    <h1 id="mysql-setting">MySql Setting</h1>

<h3 id="mac-mysql-">mac에 mysql를 설치할때</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>brew install mysql

mysql.server start
</code></pre>
</div>

<h3 id="db">사용할 DB만들기</h3>

<p>DB를 만들기 전에 MySql 기본 캐리터셋을 설정해야한다.</p>

<p>MySQL에서는 설정 파일을 다음 순서데로 읽는다.</p>

<ul>
  <li>/etc/my.cnf</li>
  <li>/etc/mysql/my.cnf</li>
  <li>/usr/local/mysql/etc/my.cnf</li>
  <li>~/.my.cnf</li>
</ul>

<p>그래서 <code class="highlighter-rouge">/etc/my.cnf</code>파일 있는지 확인 하고 없으면 <code class="highlighter-rouge">cp /usr/local/mysql/support-files/my-default.cnf /etc/my.cnf</code>으로 생성하고 다음내용을 추가한다.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="o">[</span>mysqld]
character-set-server<span class="o">=</span>utf8
collation-server<span class="o">=</span>utf8_general_ci

<span class="nv">init_connect</span><span class="o">=</span>SET <span class="nv">collation_connection</span><span class="o">=</span>utf8_general_ci
<span class="nv">init_connect</span><span class="o">=</span>SET NAMES utf8

<span class="o">[</span>client]
default-character-set<span class="o">=</span>utf8

<span class="o">[</span>mysql]
default-character-set<span class="o">=</span>utf8
</code></pre>
</div>

<p>그리고 서버 재시작</p>

<h3 id="root--">root 페스워드 설정</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>[root@test ~]# /usr/bin/mysql_secure_installation
</code></pre>
</div>

<h3 id="db---">DB생성 및 사용자 추가하기</h3>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">mysql&gt; </span>create database testdb;
Query OK, 1 row affected <span class="o">(</span>0.00 sec<span class="o">)</span>

<span class="gp">mysql&gt; </span>show create database testdb;
+----------+------------------------------------------------------------------+
| Database | Create Database                                                  |
+----------+------------------------------------------------------------------+
| testdb   | CREATE DATABASE <span class="sb">`</span>testdb<span class="sb">`</span> /<span class="k">*</span>!40100 DEFAULT CHARACTER SET utf-8 <span class="k">*</span>/ |
+----------+------------------------------------------------------------------+
1 row <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>
</code></pre>
</div>

<p>캐릭터 셋이 utf-8이 되어 있다.</p>

<p>유저생성은 다음과 같다.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>// localhost로 접속만 허용
<span class="gp">mysql&gt; </span>grant all privileges on testdb.<span class="k">*</span> to dev@localhost identified by <span class="s1">'password123'</span>;

// 원격 접속도 허용
<span class="gp">mysql&gt; </span>grant all privileges on testdb.<span class="k">*</span> to dev@<span class="s1">'%'</span> identified by <span class="s1">'password123'</span>;
</code></pre>
</div>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$&gt; </span>mysql -u dev -p
Enter password: <span class="o">(</span>앞에서 지정한 패스워드 입력<span class="o">)</span>
... 중략 ...
Type <span class="s1">'help;'</span> or <span class="s1">'\h'</span> <span class="k">for </span>help. Type <span class="s1">'\c'</span> to clear the current input statement.

<span class="gp">mysql&gt; </span>show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| testdb             |
+--------------------+
3 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>
</code></pre>
</div>

<h3 id="section">타임존 설정</h3>

<p><code class="highlighter-rouge">/etc/localtime</code> 파일 설정을 한국시간으로 바꾸기만 하면 된다.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$&gt; </span>ln -sf /usr/share/zoneinfo/Asia/Seoul /etc/localtime
<span class="gp">$&gt; </span>ls -al | grep /etc/locatime
lrwxrwxrwx  1 root root      30  7월 31 12:17 localtime -&gt; /usr/share/zoneinfo/Asia/Seoul
<span class="gp">$&gt; </span>date
2017. 07. 31. <span class="o">(</span>월<span class="o">)</span> 12:18:08 KST
</code></pre>
</div>

<h3 id="section-1">부팅시 자동시작 등록</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>[root@test ~]# chkconfig --list mysqld
mysqld         	0:off	1:off	2:off	3:off	4:off	5:off	6:off
[root@test ~]# chkconfig mysqld on
[root@test ~]# chkconfig --list mysqld 
mysqld         	0:off	1:off	2:on	3:on	4:on	5:on	6:off
</code></pre>
</div>

<h3 id="refrence">Refrence</h3>

<ul>
  <li><a href="https://goo.gl/8eEoyJ">https://goo.gl/8eEoyJ</a></li>
</ul>

                </div>
                <div class="read-all">
                    <a  href="/2017/08/01/MySql-Setting/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2017/06/26/linuxcommand/">리눅스 명령어정리</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2017-06-26
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#Unix/Linux" title="Category: Unix/Linux" rel="category">Unix/Linux</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                </div>
                <div class="excerpt">
                    <h1 id="section">자주 사용하는 리눅스 명령어 정리</h1>

<h3 id="mutt------">1. <code class="highlighter-rouge">mutt</code> - 서버에서 메일 보내기 기능</h3>

<ul>
  <li>설치방법 : yum install mutt</li>
  <li>사용 예 : `mutt -s “제목” “받는이 메일주소” -x -a “첨부파일”</li>
</ul>

<h3 id="zcat----">2. <code class="highlighter-rouge">zcat</code> - 압축안풀고 내용보기</h3>

<p>같은 명령어 <code class="highlighter-rouge">gzip -d -c</code></p>

<h3 id="wc--l-----">3. <code class="highlighter-rouge">wc -l</code> - 파일 라인수 세기</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>Usage: wc [OPTION]... [FILE]...
  or:  wc [OPTION]... --files0-from=F
Print newline, word, and byte counts for each FILE, and a total line if
more than one FILE is specified.  With no FILE, or when FILE is -,
read standard input.
  -c, --bytes            print the byte counts
  -m, --chars            print the character counts
  -l, --lines            print the newline counts
      --files0-from=F    read input from the files specified by
                           NUL-terminated names in file F;
                           If F is - then read names from standard input
  -L, --max-line-length  print the length of the longest line
  -w, --words            print the word counts
</code></pre>
</div>

<h3 id="sort---">4. <code class="highlighter-rouge">sort</code> - 정렬</h3>

<ul>
  <li>기본 사용법 : <code class="highlighter-rouge">sort [옵션] "fileName"</code></li>
  <li>ex) <code class="highlighter-rouge">sort -k2 -r data</code> : data파일의 2번째 필드을 기준으로 내림차순 정렬</li>
</ul>

<p><strong>옵션종류</strong></p>

<ul>
  <li><code class="highlighter-rouge">-f</code> =&gt; 대소문자를 구분하지않음</li>
  <li><code class="highlighter-rouge">-r</code> =&gt; 내림차순정렬</li>
  <li><code class="highlighter-rouge">-k</code> =&gt; 필드 번호를 나타냄</li>
  <li><code class="highlighter-rouge">-t</code> =&gt; 필드 구분자 지정</li>
  <li><code class="highlighter-rouge">-n</code> =&gt;숫자 순서로 정렬</li>
</ul>

<h3 id="file--bi-----">5. <code class="highlighter-rouge">file -bi</code> - 파일 인코딩 확인</h3>

<ul>
  <li>ex) <code class="highlighter-rouge">&gt; file -bi test.txt</code> =&gt; text/html; charset=utf-8</li>
</ul>

<h3 id="iconv-----">6. <code class="highlighter-rouge">iconv</code> - 파일 인코딩 변환</h3>

<ul>
  <li>ex) <code class="highlighter-rouge">iconv -c -f utf-8 -t euc-kr ttt.php &gt; ttt2.php</code> : utf-8 인코딩이었던 ttt.php 를  euc-kr 로 변환하여 ttt2.php 로 저장</li>
</ul>

<h3 id="bash-m-">7. bash <code class="highlighter-rouge">^M</code>문자 제거</h3>

<p><code class="highlighter-rouge">sed -i -e "s/\r//g" fileName</code></p>

<h3 id="ln--tfs----">8. <code class="highlighter-rouge">ln -Tfs</code> - 심볼릭링크 타겟변경</h3>

<p>ex)</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#심볼릭 링크 설정
ln -s /home/data1 /home/data
lrwxrwxrwx 1 root root    5 12월 13 19:28 data -&gt; data1

#심볼릭 링크 타겟 변경
ln -Tfs /home/data2 /home/data 
lrwxrwxrwx 1 root root    5 12월 13 19:28 data -&gt; data2
</code></pre>
</div>

<h3 id="sed----">9. <code class="highlighter-rouge">sed</code> - 스트리밍 편집기</h3>

<p><code class="highlighter-rouge">sed [-e script][-f script-file][file...]</code></p>

<p>기본적인 기능은 ed에서 따 왔으며, 이 기능들은 모두 sed에 적용이 된다. 다만 ed는 대화형 편집기이며,
sed는 스트리밍 편집기이다. 대화형 편집기와 스트리밍 편집기의 차이점은 대화형 편집기는 입력 및 출력이
하나로 이루어지며, 스트리밍 편집기는 하나의 입력이 하나의 출력을 낸다는 것이다.
\n 을 개행문자로 사용하는 스트리밍 에디터이다.</p>

<h4 id="search-print">찾기(search), 출력(print)</h4>
<p><code class="highlighter-rouge">sed -n '/abd/p' list.txt</code> : list.txt 파일을 한줄씩 읽으면서(-n : 읽은 것을 출력하지 않음) abd 문자를 찾으면 그 줄을 출력(p)한다.</p>

<h4 id="substitute">치환(substitute)</h4>
<p><code class="highlighter-rouge">sed 's/addrass/address/' list.txt</code> : addrass를 address로 바꾼다. 단, 원본파일을 바꾸지 않고 출력을 바꿔서 한다. <code class="highlighter-rouge">sed 's/addrass/address/' list.txt &gt; list2.txt</code></p>

<p><code class="highlighter-rouge">sed 's/\t/\ /' list.txt</code> : 탭문자를 엔터로 변환</p>

<p><code class="highlighter-rouge">sed 's/□□*/□/' list.txt</code> : ( *표시: □ 는 공백 문자를 표시한다. ) 위의 구문은 한개이상의 공백문자열을 하나의 공백으로 바꾼다.</p>

<h4 id="insert">추가(insert)</h4>
<p>scriptfile - s/</p>

<h4 id="delete">삭제(delete)</h4>

<p><code class="highlighter-rouge">sed '/TD/d' 1.html</code> : TD 문자가 포함된 줄을 삭제하여 출력한다.</p>

<p><code class="highlighter-rouge">sed '/Src/!d' 1.html</code> : Src 문자가 있는 줄만 지우지 않는다.</p>

<p><code class="highlighter-rouge">sed '1,2d' 1.html</code> : 처음 1줄, 2줄을 지운다.</p>

<p><code class="highlighter-rouge">sed '/^$/d 1.html</code> : 공백라인을 삭제하는 명령이다</p>

<h4 id="section-1">파일 이름만을 뽑아내는 정규식</h4>

<p><code class="highlighter-rouge">s/^.*\/\([a-zA-Z0-9.]*\)".*$/\1/</code> : ^는 라인의 맨 처음, .* 아무문자열, (, )은 정규표현식을 그룹화, $ 는 라인의 맨 끝. <code class="highlighter-rouge">( s;^.*\/\([a-zA-Z0-9.]*\)".*$;\1;)</code> \1는 그룹화된 첫번째 요소를 말한다.</p>

<p><code class="highlighter-rouge">[a-zA-Z0-9.]</code> 는 알파벳과 숫자 및 .(콤마)를 표현하는 문자(character)를 말한다.</p>

<p>즉 GF02.jpg와 같은 문자열을 첫번째 그룹화하고 난 다음 라인 전체를 그룹화된 내용으로 바꾸는 것이다.</p>

<p><code class="highlighter-rouge">/g</code> : global을 의미 한줄에 대상문자가 여러개일 때도 처리하도록 한다.</p>

<p><code class="highlighter-rouge">who | sed -e 's; .*$;;'</code> : 각 라인의 첫 번째 공백에서부터 마지막까지 삭제하라.</p>

<p><code class="highlighter-rouge">who | sed -e 's;^.* ;;'</code> : 각 라인의 처음부터 맨 마지막 공백까지 삭제하라.</p>

<p><code class="highlighter-rouge">who | sed -e 's;^.*:;;'</code> : 각 라인의 처음부터 : 문자가 있는 곳(:문자포함)까지 삭제하라.</p>

<h4 id="n-">-n 옵션</h4>

<p>sed는 항상 표준 출력에서 입력 받은 각 라인을 나타낸다는 것을 알아냈다. 그러나 때때로 한 파일로부터 몇 개의 라인들을 추출해 내기 위해 sed를 사용하기를 원할 때도 있다. 이러한 경우에 -n옵션을 사용한다. 이 옵션은 사용자가 만약 해야 할 일을 정확히 말해 주지 않는다면 임의의 라인을 프린트하는 것을 원하지 않는다고 sed에게 말한다. 따라서 p명령이 같이 쓰인다. 라인 번호와 라인 번호의 범위를 나타냄으로써 sed를 사용하여 텍스트의 라인들을 선택적으로 프린트할 수 있게 한다. 다음에서 볼 수 있는 바와 같이, 한 파일로부터 첫 번째 두 라인이 프린트되었다.</p>

<p><code class="highlighter-rouge">$ sed -n '1,2p' intro Just print the first 2 lines from intro file.</code></p>

<p>만약 라인 번호 대신에 슬래시로 에워 싸인 문자열과 함께 p명령이 쓰인다면 sed는 이들 문자들이 포함하고 있는 표준 입력을 통해서 라인들을 프린트하게 된다. 따라서 하나의 파일로부터 처음의 두 라인을 프린트하기 위하여 다음과 같이 사용될 수 있다.</p>

<p><code class="highlighter-rouge">$ sed -n '/UNIX/p' intro Just print lines containing UNIX</code></p>

<p><code class="highlighter-rouge">sed '5d'</code> : 라인 5를 삭제</p>

<p><code class="highlighter-rouge">sed '/[Tt]est/d'</code> : Test 또는 test를 포함하는 모든 라인들을 삭제</p>

<p><code class="highlighter-rouge">sed -n '20,25p' text</code> : text로부터 20에서 25까지의 라인들만 프린트</p>

<p><code class="highlighter-rouge">sed '1,10s/unix/UNIX/g' intro</code> : intro의 처음 10개의 라인들의 unix를 UNIX로 변경</p>

<p><code class="highlighter-rouge">sed '/jan/s/-1/-5'</code> : jan을 포함하는 모든 라인들 위의 첫 번째 -1을 -5로 변경</p>

<p><code class="highlighter-rouge">sed 's/...//' data</code> : 각 data라인으로부터 처음 세 개의 문자들을 삭제</p>

<p><code class="highlighter-rouge">sed 's/...$//' data</code> : 각 데이터 라인으로부터 마지막 3문자들을 삭제</p>

<p><code class="highlighter-rouge">sed -n '1' text</code> : 비 프린트 문자들을 \nn으로 (여기서 nn은 그 문자의 8진수 값임),
그 리고 탭 문자들을 &gt; 로 나타내는 각 텍스트로부터의 모든 라인들을 프린트</p>


                </div>
                <div class="read-all">
                    <a  href="/2017/06/26/linuxcommand/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
        </ul>



        <!-- Pagination links -->
        <div class="pagination">
          
            <span class="previous disable"><i class="fa fa-angle-double-left"></i></span>
            <span class="previous disable"><i class="fa fa-angle-left"></i></span>
          
          <span class="page_number ">1/11</span>
          
            <a href="/page2" class="next"><i class="fa fa-angle-right"></i></a>
            <a href="/page11" class="next"><i class="fa fa-angle-double-right"></i></a>
          
        </div>
    </div>
    <!-- <button class="anchor"><i class="fa fa-anchor"></i></button> -->
    <div class="right">
        <div class="wrap">
            <!-- Content -->
            <div class="side ">
                <div>
                    <i class="fa fa-th-list"></i>
                    Categories
                </div>
                <ul class="content-ul" cate>
                    
                    <li>
                        <a href="/category/#js" class="categories-list-item" cate="js">
                            <span class="name">
                                js
                            </span>
                            <span class="badge">8</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#web" class="categories-list-item" cate="web">
                            <span class="name">
                                web
                            </span>
                            <span class="badge">15</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#python" class="categories-list-item" cate="python">
                            <span class="name">
                                python
                            </span>
                            <span class="badge">3</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Spring" class="categories-list-item" cate="Spring">
                            <span class="name">
                                Spring
                            </span>
                            <span class="badge">4</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Hadoop" class="categories-list-item" cate="Hadoop">
                            <span class="name">
                                Hadoop
                            </span>
                            <span class="badge">2</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Java" class="categories-list-item" cate="Java">
                            <span class="name">
                                Java
                            </span>
                            <span class="badge">9</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Etc" class="categories-list-item" cate="Etc">
                            <span class="name">
                                Etc
                            </span>
                            <span class="badge">7</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Unix/Linux" class="categories-list-item" cate="Unix/Linux">
                            <span class="name">
                                Unix/Linux
                            </span>
                            <span class="badge">3</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Swift" class="categories-list-item" cate="Swift">
                            <span class="name">
                                Swift
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#MYSQL" class="categories-list-item" cate="MYSQL">
                            <span class="name">
                                MYSQL
                            </span>
                            <span class="badge">4</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#BigData" class="categories-list-item" cate="BigData">
                            <span class="name">
                                BigData
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#ElasticSearch" class="categories-list-item" cate="ElasticSearch">
                            <span class="name">
                                ElasticSearch
                            </span>
                            <span class="badge">2</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Spark" class="categories-list-item" cate="Spark">
                            <span class="name">
                                Spark
                            </span>
                            <span class="badge">3</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Cassandra" class="categories-list-item" cate="Cassandra">
                            <span class="name">
                                Cassandra
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#Scala" class="categories-list-item" cate="Scala">
                            <span class="name">
                                Scala
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                </ul>
            </div>
            <div class="side">
                <div>
                    <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                    Recent Posts
                </div>
                <ul class="content-ul" recent>
                    
                        <li><a href="/2017/10/24/sparkstreamingandkafka/">SparStreaming & kafka(Exactly-once)</a></li>
                    
                        <li><a href="/2017/09/27/spark_misapprehension/">Spark에 대한 오해</a></li>
                    
                        <li><a href="/2017/08/06/howtousesbt/">sbt 기본 사용법</a></li>
                    
                        <li><a href="/2017/08/02/pythonTricks/">Python Tricks</a></li>
                    
                        <li><a href="/2017/08/01/MySql-Setting/">MySQL 기본세팅법</a></li>
                    
                        <li><a href="/2017/06/26/linuxcommand/">리눅스 명령어정리</a></li>
                    
                        <li><a href="/2017/05/09/javarxe/">java 유용한 정규표현식</a></li>
                    
                        <li><a href="/2017/05/04/logback/">LogBack</a></li>
                    
                        <li><a href="/2017/04/20/resourcecleanup/">Resource CleanUp</a></li>
                    
                        <li><a href="/2017/04/08/garbagecollectionpauses/">Garbage collection pauses</a></li>
                    
                </ul>
            </div>

<!--
            <div class="side">
                <div>
                    <i class="fa fa-tags"></i>
                    Tags
                </div>
                <div class="tags-cloud">
                    
                    
                    
                    

                    

                    
                </div>
            </div> -->
        </div>
    </div>
</div>


    <footer class="site-footer">


    <div class="wrapper">

        <p class="description">
            
        </p>
        <p class="contact">
            Contact me at: 
            <a href="https://github.com/joswlv" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a>  
            <a href="mailto:wh7923@gmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>     
            <a href="https://www.facebook.com/wsj7923" title="Facebook"><i class="fa fa-facebook-official" aria-hidden="true"></i></a>    
        </p>
        <p>
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>
        </p>
    </div>
</footer>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <div class="back-to-top">
    <a href="#top" class="scroll">
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/scroll.min.js " charset="utf-8"></script>
  </body>

</html>
